# 1. Equations
# 1.1 Identities
# Households
sav_h=W+div_ff+iD_h-C-Tax-iM
V_h=D_h+p_h*h+e_ff-M
D_h=D_h(-1)+sav_h+M_new-rep_m-(e_ff-e_ff(-1))
YD=W+div_ff+iD_h-Tax-iM
M=M(-1)+M_new-rep_m-M_np
#Firms
sav_f=C+I+UC*(Inv-Inv(-1))+G-W-div_f-iLL-iSL_f
V_f=K+UC*Inv-LL-SL_f-p_ef*e_f
SL_f=SL_f(-1)+I-sav_f-LL_sup+rep_LL+(Inv-Inv(-1))*UC
K=k(-1)*p(-1)-delta_k*k(-1)*p(-1)+(p-p(-1))*(k(-1)-delta_k*k(-1))+i*p
k=k(-1)+i-delta_k*k(-1)
LL=LL(-1)+LL_sup-rep_LL-LL_np
#Banks
#Bank 1
sav_b1=iM_b1+fee_b1+iLL_b1+iSL_b1+iIB_b1+r_cbd(-1)*R_b1(-1)-iD_b1-r_bb(-1)*bb_b1(-1)-r_cbl(-1)*A_b1(-1)-div_b1
Pr_b1=iM_b1+fee_b1+iLL_b1+iSL_b1+iIB_b1+r_cbd(-1)*R_b1(-1)-iD_b1-r_bb(-1)*bb_b1(-1)-r_cbl(-1)*A_b1(-1)-M_npb1-LL_npb1
Pr_b1e=Pr_b1e(-1)+psi*(Pr_b1(-1)-Pr_b1e(-1))
V_b1=R_b1+LL_b1+SL_b1+M_b1ns+IBL_b1-D_b1-IBA_b1-A_b1-p_bb*bb_b1
V_bb1=R_b1+LL_b1+SL_b1+M_b1ns+IBL_b1-D_b1-IBA_b1-A_b1
V_bb1e=V_bb1(-1)+Pr_b1e
A_b1=max(R_tb1-R_lb1,0)
R_b1=R_pb1+IBA_b1-IBL_b1+A_b1
#Bank 2
sav_b2=iM_b2+fee_b2+iLL_b2+iSL_b2+iIB_b2+r_cbd(-1)*R_b2(-1)-iD_b2-r_bb(-1)*bb_b2(-1)-r_cbl(-1)*A_b2(-1)-div_b2
Pr_b2=iM_b2+fee_b2+iLL_b2+iSL_b2+iIB_b2+r_cbd(-1)*R_b2(-1)-iD_b2-r_bb(-1)*bb_b2(-1)-r_cbl(-1)*A_b2(-1)-M_npb2-LL_npb2
Pr_b2e=Pr_b2e(-1)+psi*(Pr_b2(-1)-Pr_b2e(-1))
V_b2=R_b2+LL_b2+SL_b2+M_b2ns+IBL_b2-D_b2-IBA_b2-A_b2-p_bb*bb_b2
V_bb2=R_b2+LL_b2+SL_b2+M_b2ns+IBL_b2-D_b2-IBA_b2-A_b2
V_bb2e=V_bb2(-1)+Pr_b2e
A_b2=max(R_tb2-R_lb2,0)
R_b2=R_pb2+IBA_b2-IBL_b2+A_b2
#Bank 3
sav_b3=iM_b3+fee_b3+iLL_b3+iSL_b3+iIB_b3+r_cbd(-1)*R_b3(-1)-iD_b3-r_bb(-1)*bb_b3(-1)-r_cbl(-1)*A_b3(-1)-div_b3
Pr_b3=iM_b3+fee_b3+iLL_b3+iSL_b3+iIB_b3+r_cbd(-1)*R_b3(-1)-iD_b3-r_bb(-1)*bb_b3(-1)-r_cbl(-1)*A_b3(-1)-M_npb3-LL_npb3
Pr_b3e=Pr_b3e(-1)+psi*(Pr_b3(-1)-Pr_b3e(-1))
V_b3=R_b3+LL_b3+SL_b3+M_b3ns+IBL_b3-D_b3-IBA_b3-A_b3-p_bb*bb_b3
V_bb3=R_b3+LL_b3+SL_b3+M_b3ns+IBL_b3-D_b3-IBA_b3-A_b3
V_bb3e=V_bb3(-1)+Pr_b3e
A_b3=max(R_tb3-R_lb3,0)
R_b3=R_pb3+IBA_b3-IBL_b3+A_b3
#Financial Firms
sav_ff=div_f+iM_s+r_bb(-1)*bb(-1)+r_gb(-1)*gb_ff(-1)+iD_ff+div_b-div_ff-fee-iSL_ff
V_ff=GB_ff+p_ef*e_f+p_bb*bb+D_ff+M_s-SL_ff-e_ff
SL_ff=ifelse(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)>=p_bb*(bb-bb(-1))+(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)-rep_ms-p_gb*rep_gbff+p_gb*(gb_s-gb_rcb)-p_gb*gb_dcb+p_gb*gb_scb+SL_ff(-1),0,-(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)-p_bb*(bb-bb(-1))-(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)+rep_ms+p_gb*rep_gbff-p_gb*(gb_s-gb_rcb)+p_gb*gb_dcb-p_gb*gb_scb-SL_ff(-1)))
D_ff=ifelse(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)>=p_bb*(bb-bb(-1))+(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)-rep_ms-p_gb*rep_gbff+p_gb*(gb_s-gb_rcb)-p_gb*gb_dcb+p_gb*gb_scb+SL_ff(-1),sav_ff+(e_ff-e_ff(-1))+D_ff(-1)-p_bb*(bb-bb(-1))-(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)+rep_ms+p_gb*rep_gbff-p_gb*(gb_s-gb_rcb)+p_gb*gb_dcb-p_gb*gb_scb-SL_ff(-1),0)
M_s=M_s(-1)+s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3-rep_ms-M_nps
#Government
sav_g=Tax+PCB-G-r_gb(-1)*gb(-1)
PSBR=G+r_gb(-1)*gb(-1)-Tax-PCB
V_g=-GB
#Central Bank
PCB=r_gb(-1)*gb_cb(-1)+r_cbl(-1)*A(-1)-r_cbd(-1)*R(-1)
sav_cb=r_gb(-1)*gb_cb(-1)+r_cbl(-1)*A(-1)-r_cbd(-1)*R(-1)-PCB
V_cb=GB_cb+A-R
A=A_b1+A_b2+A_b3
#1.2 Behavioural equations
#Households
YD_e=YD_e(-1)+psi*(YD(-1)-YD_e(-1))
p_e=p_e(-1)+psi*(p(-1)-p_e(-1))
V_he=V_h(-1)+(YD_e-c_d*p_e)+CG_he
CG_he=(p_h(-1)-p_h(-2))*h
c_d=alpha1*YD_e/p_e+alpha2*V_h(-1)/p_e
rr_d=(1+r_dav)/(1+pi)-1
alpha1=alpha1L+((alpha1U-alpha1L)/(1+exp(sigmampc1*rr_de-sigmampc2)))
alpha2=alpha2L+((alpha2U-alpha2L)/(1+exp(sigmampc1*rr_de-sigmampc2)))
rr_de=rr_de(-1)+psi*(rr_d(-1)-rr_de(-1))
C=c*p
M_dem=LTV*H_dn
H_dn=rho0+rho1*V_he-rho2*LTV-rho3*r_mav(-1)
r_mav=r_Mb1*(M_b1ns(-1)/M(-1))+r_Mb2*(M_b2ns(-1)/M(-1))+r_Mb3*(M_b3ns(-1)/M(-1))+r_Ms*(M_s(-1)/M(-1))
M_demb1=(lambdam11+lambdam2*(r_Mb2-r_Mb1)+lambdam2*(r_Mb3-r_Mb1))*M_dem
M_demb2=(lambdam12+lambdam2*(r_Mb1-r_Mb2)+lambdam2*(r_Mb3-r_Mb2))*M_dem
M_demb3=(lambdam13+lambdam2*(r_Mb1-r_Mb3)+lambdam2*(r_Mb2-r_Mb3))*M_dem
H_def=ifelse(M_dem>M_new, M_new+(1-LTV)*H_dn, H_dn)
H_s=eta*p_h*h
p_h=H_def/(eta*h)
lev_h=M/(p_h*h+D_h+e_ff)
iM=iM_b1+iM_b2+iM_b3+iM_s
iD_h=iD_hb1+iD_hb2+iD_hb3
M_new=M_newb1+M_newb2+M_newb3
rep_m=rep_mb1+rep_mb2+rep_mb3+rep_ms
M_np=M_npb1+M_npb2+M_npb3+M_nps
TAA_h=D_h+e_ff
TAA_he=TAA_he(-1)+psi*(TAA_h(-1)-TAA_he(-1))
e_ffd=(lambdaeff10-lambdaeff11*r_dav+lambdaeff12*ror_effe)*TAA_he-lambdaeff13*YD_e
ror_eff=div_ff/e_ff(-1)
ror_effe=ror_effe(-1)+psi*(ror_eff(-1)-ror_effe(-1))
D_hb1=(lambdadh11+lambdadh2*(r_db1-r_db2)+lambdadh2*(r_db1-r_db3))*D_h
D_hb2=(lambdadh12+lambdadh2*(r_db2-r_db1)+lambdadh2*(r_db2-r_db3))*D_h
D_hb3=(lambdadh13+lambdadh2*(r_db3-r_db1)+lambdadh2*(r_db3-r_db2))*D_h
N_s=N_d
w=w(-1)*(1+beta1*(u_e-u_nw))
u_nw=u_nw(-1)+psiu*(u(-1)-u_nw(-1))
u_e=u_e(-1)+psi*(u(-1)-u_e(-1))
#Firms
p=(1+theta)*UC_e
UC=W/y
UC_e=UC_e(-1)+psi*(UC(-1)-UC_e(-1))
W=w*p*N_d
y=min(k(-1)/kappa, c_e+i+g+(Inv_t-Inv(-1)))
c=ifelse(c_d+i+g<=k(-1)/kappa+Inv(-1), min(c_d, c_e+Inv_t), y-i-g+Inv(-1))
N_d=y/alpha
Y=y*p
I=i*p
i_d=gamma0+gammau*(u_e-u_n)-gammal*lev_f(-1)*r_LLav(-1)
lev_f=(LL)/(K)
r_LLav=r_LLb1*(LL_b1(-1)/LL(-1))+r_LLb2*(LL_b2(-1)/LL(-1))+r_LLb3*(LL_b3(-1)/LL(-1))
i=ifelse(LL_d>LL_sup, (sav_ft+LL_sup-rep_LL)/p, i_d)
LL_d=max(0,p*i_d-sav_ft+rep_LL)
LL_db1=(lambdall11+lambdall2*(r_LLb1-r_LLb2)+lambdall2*(r_LLb1-r_LLb3))*LL_d
LL_db2=(lambdall12+lambdall2*(r_LLb2-r_LLb1)+lambdall2*(r_LLb2-r_LLb3))*LL_d
LL_db3=(lambdall13+lambdall2*(r_LLb3-r_LLb2)+lambdall2*(r_LLb3-r_LLb2))*LL_d
c_e=c_e(-1)+psi*(c(-1)-c_e(-1))
Inv_t=gamma1*y(-1)
Inv=Inv(-1)+y-c-i-g
SL_fdb1=(lambdaslf11+lambdaslf2*(r_SLb2-r_SLb1)+lambdaslf2*(r_SLb3-r_SLb1))*SL_f
SL_fdb2=(lambdaslf12+lambdaslf2*(r_SLb1-r_SLb2)+lambdaslf2*(r_SLb3-r_SLb2))*SL_f
SL_fdb3=(lambdaslf13+lambdaslf2*(r_SLb1-r_SLb3)+lambdaslf2*(r_SLb2-r_SLb3))*SL_f
u=y/(k(-1)/kappa)
Pr_f=C+I+G+UC*(Inv-Inv(-1))-W-iLL-iSL_f
sav_ft=max(0,LL(-1)+p*i_d-lev_ft*(K(-1)+p*i_d-p(-1)*delta_k*k(-1)))
div_f=max(0,Pr_f-sav_ft)
rep_LL=rep_LLb1+rep_LLb2+rep_LLb3
LL_np=LL_npb1+LL_npb2+LL_npb3
iLL=iLL_b1+iLL_b2+iLL_b3
iSL_f=iSL_fb1+iSL_fb2+iSL_fb3
#Banks
#Bank 1
iM_b1=r_Mcb1(-1)*(M_b1ns(-1)-M_npb1)
iLL_b1=r_LLcb1(-1)*(LL_b1(-1)-LL_npb1)
iSL_fb1=r_SLb1(-1)*SL_fb1(-1)
iSL_ffb1=r_SLb1(-1)*SL_ffb1(-1)
iSL_b1=iSL_fb1+iSL_ffb1
iD_hb1=r_db1(-1)*D_hb1(-1)
iD_ffb1=r_db1(-1)*D_ffb1(-1)
iD_b1=iD_hb1+iD_ffb1
iIB_b1=r_IB(-1)*(IBL_b1(-1)-IBA_b1(-1))
fee_b1=f*s_b1*M_newb1
M_b1ns=M_b1ns(-1)+(1-s_b1)*M_newb1-rep_mb1-M_npb1
M_newb1=min(xi1*M_demb1,xi2*M_demb1)
xi1=ifelse(CARb1_e/CARt<1, CARb1_e/CARt, 1)
xi2=ifelse(SFRb1_e/SFRt<1, SFRb1_e/SFRt, 1)
rep_mb1=chi_mb1*M_b1ns(-1) 
M_npb1=zeta_mb1*lev_h(-1)*M_b1ns(-1)
LL_b1=LL_b1(-1)+LL_supb1-rep_LLb1-LL_npb1
LL_supb1=min(xi1*LL_db1,xi2*LL_db1)
rep_LLb1=chi_LLb1*LL_b1(-1)
LL_npb1=zeta_LLb1*lev_f(-1)*LL_b1(-1)
SL_fb1=SL_fdb1
SL_ffb1=SL_ffdb1
SL_b1=SL_fdb1+SL_ffdb1
clear_b1=(D_b1-D_b1(-1))+rep_LLb1+rep_mb1-LL_supb1-(SL_b1-SL_b1(-1))-(1-s_b1)*M_newb1+iLL_b1+iSL_b1+iM_b1-iD_b1-iBB_b1+p_bb*(bb_b1-bb_b1(-1))+fee_b1-div_b1
R_pb1=R_b1(-1)+clear_b1+IBL_b1(-1)-IBA_b1(-1)-A_b1(-1)-r_IB(-1)*IBA_b1(-1)+r_IB(-1)*IBL_b1(-1)-r_cbl(-1)*A_b1(-1)+r_cbd(-1)*R_b1(-1)
R_tb1=LCRt*omega4*D_b1
R_anb1=R_pb1-R_tb1
IBL_sb1=ifelse(R_anb1>0,R_anb1,0)
IBA_db1=ifelse(R_anb1<0,abs(R_anb1),0)
IBL_sb1b2=ifelse(IBA_db2>=IBL_sb1+IBL_sb3&IBL_sb3>0&IBL_sb1>0,IBL_sb1,ifelse(IBA_db2<IBL_sb1+IBL_sb3&IBL_sb1>0&IBL_sb3>0,IBA_db2*(IBL_sb1/(IBL_sb1+IBL_sb3)),ifelse(IBA_db2+IBA_db3>=IBL_sb1&IBL_sb1>0&IBA_db3>0,IBL_sb1*(IBA_db2/(IBA_db2+IBA_db3)),ifelse(IBA_db2+IBA_db3<IBL_sb1&IBL_sb1>0,IBA_db2,0))))
IBL_sb1b3=ifelse(IBA_db3>=IBL_sb1+IBL_sb2&IBL_sb2>0&IBL_sb1>0,IBL_sb1,ifelse(IBA_db3<IBL_sb1+IBL_sb2&IBL_sb1>0&IBL_sb2>0,IBA_db3*(IBL_sb1/(IBL_sb1+IBL_sb2)),ifelse(IBA_db3+IBA_db2>=IBL_sb1&IBL_sb1>0&IBA_db2>0,IBL_sb1*(IBA_db3/(IBA_db3+IBA_db2)),ifelse(IBA_db3+IBA_db2<IBL_sb1&IBL_sb1>0,IBA_db3,0))))
IBL_b1b2=IBL_sb1b2
IBL_b1b3=IBL_sb1b3
IBA_b1b2=IBL_sb2b1
IBA_b1b3=IBL_sb3b1
IBL_b1=IBL_b1b2+IBL_b1b3
IBA_b1=IBA_b1b2+IBA_b1b3
R_lb1=R_pb1+IBA_b1-IBL_b1
div_b1t=max(0,V_bb1e-V_bb1te)
div_b1=max(0,div_b1(-1)+psi*(div_b1t-div_b1(-1)))
V_bb1pde=V_bb1(-1)+Pr_b1e-div_b1
bb_b1t=max(100,bb_b1(-1)+(CARt*(omega2*LL_b1+omega3*SL_b1+omega1*M_b1ns+omega0*IBL_b1)-V_bb1pde)/p_bb)
bb_b1te=bb_b1te(-1)+psi*(bb_b1t(-1)-bb_b1te(-1))
bb_sb1=epsiloncarbb*(bb_b1te-bb_b1(-1))
bb_b1=bb_b1(-1)+bb_sb1
r_SLb1=r_cbl+epsilonsl1+epsilonsfrsl*(SFRt-SFRb1_e)+epsiloncarsl*(CARt-CARb1_e)+epsilonr*(r_SLav(-1)-r_SLb1(-1))
r_LLcb1=(r_LLb1(-1)*LL_b1(-1)+r_LLb1*LL_supb1)/LL_b1
r_LLb1=r_cbl+epsilonll1+epsilonsfrll*(SFRt-SFRb1_e)+epsiloncarll*(CARt-CARb1_e)+epsilonr*(r_LLav(-1)-r_LLb1(-1))
r_Mcb1=(r_Mb1(-1)*M_b1ns(-1)+r_Mb1*M_newb1)/M_b1ns
r_Mb1=r_cbl+epsilonm1+epsilonsfrm*(SFRt-SFRb1_e)+epsiloncarm*(CARt-CARb1_e)+epsilonr*(r_mav(-1)-r_Mb1(-1))
r_db1=r_cbd+epsilond1+epsilonr*(r_dav(-1)-r_db1(-1))+epsilonsfrd*(SFRt-SFRb1_e)
D_b1=D_hb1+D_ffb1
#Bank 2
iM_b2=r_Mcb2(-1)*(M_b2ns(-1)-M_npb2)
iLL_b2=r_LLcb2(-1)*(LL_b2(-1)-LL_npb2)
iSL_fb2=r_SLb2(-1)*SL_fb2(-1)
iSL_ffb2=r_SLb2(-1)*SL_ffb2(-1)
iSL_b2=iSL_fb2+iSL_ffb2
fee_b2=f*s_b2*M_newb2
iD_hb2=r_db2(-1)*D_hb2(-1)
iD_ffb2=r_db2(-1)*D_ffb2(-1)
iD_b2=iD_hb2+iD_ffb2
iIB_b2=r_IB(-1)*(IBL_b2(-1)-IBA_b2(-1))
M_b2ns=M_b2ns(-1)+(1-s_b2)*M_newb2-rep_mb2-M_npb2
M_newb2=min(xi3*M_demb2,xi4*M_demb2)
xi3=ifelse(CARb2_e/CARt<1, CARb2_e/CARt, 1)
xi4=ifelse(SFRb2_e/SFRt<1, SFRb2_e/SFRt, 1)
rep_mb2=chi_mb2*M_b2ns(-1)
M_npb2=zeta_mb2*lev_h(-1)*M_b2ns(-1)
LL_b2=LL_b2(-1)+LL_supb2-rep_LLb2-LL_npb2
LL_supb2=min(xi3*LL_db2,xi4*LL_db2)
rep_LLb2=chi_LLb2*LL_b2(-1)
LL_npb2=zeta_LLb2*lev_f(-1)*LL_b2(-1)
SL_fb2=SL_fdb2
SL_ffb2=SL_ffdb2
SL_b2=SL_fdb2+SL_ffdb2
clear_b2=(D_b2-D_b2(-1))+rep_LLb2+rep_mb2-LL_supb2-(SL_b2-SL_b2(-1))-(1-s_b2)*M_newb2+iLL_b2+iSL_b2+iM_b2-iD_b2-iBB_b2+p_bb*(bb_b2-bb_b2(-1))+fee_b2-div_b2
R_pb2=R_b2(-1)+clear_b2+IBL_b2(-1)-IBA_b2(-1)-A_b2(-1)-r_IB(-1)*IBA_b2(-1)+r_IB(-1)*IBL_b2(-1)-r_cbl(-1)*A_b2(-1)+r_cbd(-1)*R_b2(-1)
R_tb2=LCRt*omega5*D_b2
R_anb2=R_pb2-R_tb2
IBL_sb2=ifelse(R_anb2>0,R_anb2,0)
IBA_db2=ifelse(R_anb2<0,abs(R_anb2),0)
IBL_sb2b1=ifelse(IBA_db1>=IBL_sb2+IBL_sb3&IBL_sb3>0&IBL_sb2>0,IBL_sb2,ifelse(IBA_db1<IBL_sb2+IBL_sb3&IBL_sb2>0&IBL_sb3>0,IBA_db1*(IBL_sb2/(IBL_sb2+IBL_sb3)),ifelse(IBA_db1+IBA_db3>=IBL_sb2&IBL_sb2>0&IBA_db3>0,IBL_sb2*(IBA_db1/(IBA_db1+IBA_db3)),ifelse(IBA_db1+IBA_db3<IBL_sb2&IBL_sb2>0,IBA_db1,0))))
IBL_sb2b3=ifelse(IBA_db3>=IBL_sb2+IBL_sb1&IBL_sb1>0&IBL_sb2>0,IBL_sb2,ifelse(IBA_db3<IBL_sb2+IBL_sb1&IBL_sb2>0&IBL_sb1>0,IBA_db3*(IBL_sb2/(IBL_sb2+IBL_sb1)),ifelse(IBA_db3+IBA_db1>=IBL_sb2&IBL_sb2>0&IBA_db1>0,IBL_sb2*(IBA_db3/(IBA_db3+IBA_db1)),ifelse(IBA_db3+IBA_db1<IBL_sb2&IBL_sb2>0,IBA_db3,0))))
IBL_b2b1=IBL_sb2b1
IBL_b2b3=IBL_sb2b3
IBA_b2b1=IBL_b1b2
IBA_b2b3=IBL_b3b2
IBL_b2=IBL_b2b1+IBL_b2b3
IBA_b2=IBA_b2b1+IBA_b2b3
R_lb2=R_pb2+IBA_b2-IBL_b2
bb_sb2=epsiloncarbb*(bb_b2te-bb_b2(-1))
bb_b2=bb_b2(-1)+bb_sb2
r_Mcb2=(r_Mb2(-1)*M_b2ns(-1)+r_Mb2*M_newb2)/M_b2ns
r_Mb2=r_cbl+epsilonm2+epsilonsfrm*(SFRt-SFRb2_e)+epsiloncarm*(CARt-CARb2_e)+epsilonr*(r_mav(-1)-r_Mb2(-1))
r_LLcb2=(r_LLb2(-1)*LL_b2(-1)+r_LLb2*LL_supb2)/LL_b2
r_LLb2=r_cbl+epsilonll2+epsilonsfrll*(SFRt-SFRb2_e)+epsiloncarll*(CARt-CARb2_e)+epsilonr*(r_LLav(-1)-r_LLb2(-1))
r_SLb2=r_cbl+epsilonsl2+epsilonsfrsl*(SFRt-SFRb2_e)+epsiloncarsl*(CARt-CARb2_e)+epsilonr*(r_SLav(-1)-r_SLb2(-1))
r_db2=r_cbd+epsilond2+epsilonr*(r_dav(-1)-r_db2(-1))+epsilonsfrd*(SFRt-SFRb2_e)
D_b2=D_hb2+D_ffb2
div_b2t=max(0,V_bb2e-V_bb2te)
div_b2=max(0,div_b2(-1)+psi*(div_b2t-div_b2(-1)))
V_bb2pde=V_bb2(-1)+Pr_b2e-div_b2
bb_b2t=max(100,bb_b2(-1)+(CARt*(omega2*LL_b2+omega3*SL_b2+omega1*M_b2ns+omega0*IBL_b2)-V_bb2pde)/p_bb)
bb_b2te=bb_b2te(-1)+psi*(bb_b2t(-1)-bb_b2te(-1))
#Bank 3
iM_b3=r_Mcb3(-1)*(M_b3ns(-1)-M_npb3)
iLL_b3=r_LLcb3(-1)*(LL_b3(-1)-LL_npb3)
iSL_fb3=r_SLb3(-1)*SL_fb3(-1)
iSL_ffb3=r_SLb3(-1)*SL_ffb3(-1)
iSL_b3=iSL_fb3+iSL_ffb3
fee_b3=f*s_b3*M_newb3
iD_hb3=r_db3(-1)*D_hb3(-1)
iD_ffb3=r_db3(-1)*D_ffb3(-1)
iD_b3=iD_hb3+iD_ffb3
iIB_b3=r_IB(-1)*(IBL_b3(-1)-IBA_b3(-1))
M_b3ns=M_b3ns(-1)+(1-s_b3)*M_newb3-rep_mb3-M_npb3
M_newb3=min(xi5*M_demb3,xi6*M_demb3)
xi5=ifelse(CARb3_e/CARt<1, CARb3_e/CARt, 1)
xi6=ifelse(SFRb3_e/SFRt<1, SFRb3_e/SFRt, 1)
rep_mb3=chi_mb3*M_b3ns(-1)
M_npb3=zeta_mb3*lev_h(-1)*M_b3ns(-1)
LL_b3=LL_b3(-1)+LL_supb3-rep_LLb3-LL_npb3
LL_supb3=min(xi5*LL_db3,xi6*LL_db3)
rep_LLb3=chi_LLb3*LL_b3(-1)
LL_npb3=zeta_LLb3*lev_f(-1)*LL_b3(-1)
SL_fb3=SL_fdb3
SL_ffb3=SL_ffdb3
SL_b3=SL_fdb3+SL_ffdb3
clear_b3=(D_b3-D_b3(-1))+rep_LLb3+rep_mb3-LL_supb3-(SL_b3-SL_b3(-1))-(1-s_b3)*M_newb3+iLL_b3+iSL_b3+iM_b3-iD_b3-iBB_b3+p_bb*(bb_b3-bb_b3(-1))+fee_b3-div_b3
R_pb3=R_b3(-1)+clear_b3+IBL_b3(-1)-IBA_b3(-1)-A_b3(-1)-r_IB(-1)*IBA_b3(-1)+r_IB(-1)*IBL_b3(-1)-r_cbl(-1)*A_b3(-1)+r_cbd(-1)*R_b3(-1)
R_tb3=LCRt*omega6*D_b3
R_anb3=R_pb3-R_tb3
IBL_sb3=ifelse(R_anb3>0,R_anb3,0)
IBA_db3=ifelse(R_anb3<0,abs(R_anb3),0)
IBL_sb3b1=ifelse(IBA_db1>=IBL_sb3+IBL_sb2&IBL_sb2>0&IBL_sb3>0,IBL_sb3,ifelse(IBA_db1<IBL_sb3+IBL_sb2&IBL_sb3>0&IBL_sb2>0,IBA_db1*(IBL_sb3/(IBL_sb3+IBL_sb2)),ifelse(IBA_db1+IBA_db2>=IBL_sb3&IBL_sb3>0&IBA_db2>0,IBL_sb3*(IBA_db1/(IBA_db1+IBA_db2)),ifelse(IBA_db1+IBA_db2<IBL_sb3&IBL_sb3>0,IBA_db1,0))))
IBL_sb3b2=ifelse(IBA_db2>=IBL_sb3+IBL_sb1&IBL_sb1>0&IBL_sb3>0,IBL_sb3,ifelse(IBA_db2<IBL_sb3+IBL_sb1&IBL_sb3>0&IBL_sb1>0,IBA_db2*(IBL_sb3/(IBL_sb3+IBL_sb1)),ifelse(IBA_db2+IBA_db1>=IBL_sb3&IBL_sb3>0&IBA_db1>0,IBL_sb3*(IBA_db2/(IBA_db2+IBA_db1)),ifelse(IBA_db2+IBA_db1<IBL_sb3&IBL_sb3>0,IBA_db2,0))))
IBL_b3b1=IBL_sb3b1
IBL_b3b2=IBL_sb3b2
IBA_b3b1=IBL_b1b3
IBA_b3b2=IBL_b2b3
IBL_b3=IBL_b3b1+IBL_b3b2
IBA_b3=IBA_b3b1+IBA_b3b2
R_lb3=R_pb3+IBA_b3-IBL_b3
bb_sb3=epsiloncarbb*(bb_b3te-bb_b3(-1))
bb_b3=bb_b3(-1)+bb_sb3
r_Mcb3=(r_Mb3(-1)*M_b3ns(-1)+r_Mb3*M_newb3)/M_b3ns
r_Mb3=r_cbl+epsilonm3+epsilonsfrm*(SFRt-SFRb3_e)+epsiloncarm*(CARt-CARb3_e)+epsilonr*(r_mav(-1)-r_Mb3(-1))
r_LLcb3=(r_LLb3(-1)*LL_b3(-1)+r_LLb3*LL_supb3)/LL_b3
r_LLb3=r_cbl+epsilonll3+epsilonsfrll*(SFRt-SFRb3_e)+epsiloncarll*(CARt-CARb3_e)+epsilonr*(r_LLav(-1)-r_LLb3(-1))
r_SLb3=r_cbl+epsilonsl3+epsilonsfrsl*(SFRt-SFRb3_e)+epsiloncarsl*(CARt-CARb3_e)+epsilonr*(r_SLav(-1)-r_SLb3(-1))
r_db3=r_cbd+epsilond3+epsilonr*(r_dav(-1)-r_db3(-1))+epsilonsfrd*(SFRt-SFRb3_e)
D_b3=D_hb3+D_ffb3
div_b3t=max(0,V_bb3e-V_bb3te)
div_b3=max(0,div_b3(-1)+psi*(div_b3t-div_b3(-1)))
V_bb3pde=V_bb3(-1)+Pr_b3e-div_b3
bb_b3t=max(100,bb_b3(-1)+(CARt*(omega2*LL_b3+omega3*SL_b3+omega1*M_b3ns+omega0*IBL_b3)-V_bb3pde)/p_bb)
bb_b3te=bb_b3te(-1)+psi*(bb_b3t(-1)-bb_b3te(-1))
#all banks
CAR=V_bb1/(V_bb1+V_bb2+V_bb3)*CARb1+V_bb2/(V_bb1+V_bb2+V_bb3)*CARb2+V_bb3/(V_bb1+V_bb2+V_bb3)*CARb3
CAR_e=CAR_e(-1)+psi*(CAR(-1)-CAR_e(-1))
LL_sup=LL_supb1+LL_supb2+LL_supb3
r_bb=r_gb+omega12-omega13*(CAR_e-CARt)
deltabbd=bb_d-bb_d(-1)
deltabbd_e=deltabbd_e(-1)+psi*(deltabbd(-1)-deltabbd_e(-1))
p_bb=((lambdaff20-lambdaff21*ror_gbe+lambdaff22*ror_bbe-lambdaff23*ror_efe-lambdaff24*r_dav)*(TAA_ffe))/bb
r_dav=r_db1*((D_hb1(-1)+D_ffb1(-1))/(D_h(-1)+D_ff(-1)))+r_db2*((D_hb2(-1)+D_ffb2(-1))/(D_h(-1)+D_ff(-1)))+r_db3*((D_hb3(-1)+D_ffb3(-1))/(D_h(-1)+D_ff(-1)))
r_SLav=r_SLb1*((SL_fb1(-1)+SL_ffb1(-1))/(SL_f(-1)+SL_ff(-1)))+r_SLb2*((SL_fb2(-1)+SL_ffb2(-1))/(SL_f(-1)+SL_ff(-1)))+r_SLb3*((SL_fb3(-1)+SL_ffb3(-1))/(SL_f(-1)+SL_ff(-1)))
r_IB=r_cbd+((r_cbl-r_cbd)/(1+exp(-sigmaIB*(IBD-IBS))))
IBS=IBL_sb1+IBL_sb2+IBL_sb3
IBD=IBA_db1+IBA_db2+IBA_db3
div_b=div_b1+div_b2+div_b3
#Financial Firms
Pr_ff=div_f+iM_s+r_bb(-1)*bb(-1)+r_gb(-1)*gb_ff(-1)+iD_ff+div_b-fee-iSL_ff
div_ff=max(div_ff(-1)+psi_ff*(f_ff*Pr_ff-div_ff(-1)),0)
iD_ff=iD_ffb1+iD_ffb2+iD_ffb3
iM_s=r_Mcs(-1)*(M_s(-1)-M_nps)
r_Mcs=(r_Ms(-1)*M_s(-1)+r_Ms*(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3))/M_s
r_Ms=(r_Mb1*M_b1ns(-1)/(M(-1)-M_s(-1))+r_Mb2*M_b2ns(-1)/(M(-1)-M_s(-1))+r_Mb3*M_b3ns(-1)/(M(-1)-M_s(-1)))
fee=fee_b1+fee_b2+fee_b3
iSL_ff=iSL_ffb1+iSL_ffb2+iSL_ffb3
rep_ms=chi_ms*M_s(-1)
M_nps=zeta_ms*lev_h(-1)*M_s(-1)
SL_ffdb1=(lambdaslff11+lambdaslff2*(r_SLb2-r_SLb1)+lambdaslff2*(r_SLb3-r_SLb1))*SL_ff
SL_ffdb2=(lambdaslff12+lambdaslff2*(r_SLb1-r_SLb2)+lambdaslff2*(r_SLb3-r_SLb2))*SL_ff
SL_ffdb3=(lambdaslff13+lambdaslff2*(r_SLb1-r_SLb3)+lambdaslff2*(r_SLb2-r_SLb3))*SL_ff
D_ffb1=(lambdadff11+lambdadff2*(r_db1-r_db2)+lambdadff2*(r_db1-r_db3))*D_ff
D_ffb2=(lambdadff12+lambdadff2*(r_db2-r_db1)+lambdadff2*(r_db2-r_db3))*D_ff
D_ffb3=(lambdadff13+lambdadff2*(r_db3-r_db1)+lambdadff2*(r_db3-r_db2))*D_ff
TAA_ff=D_ff+GB_ff+p_ef*e_f+BB
TAA_ffe=TAA_ffe(-1)+psi*(TAA_fft(-1)-TAA_ffe(-1))
TAA_fft=AE_fft*e_ff
roa_ff=Pr_ff/(D_ff+GB_ff+E_f+BB)
gb_d=((lambdaff10+lambdaff11*ror_gbe-lambdaff12*ror_bbe-lambdaff13*ror_efe-lambdaff14*r_dav)*TAA_ffe)/p_gb
GB_d=gb_d*p_gb
gb_ff=gb_ff(-1)+(gb_s-gb_rcb)-rep_gbff-gb_dcb+gb_scb
GB_ff=gb_ff*p_gb
bb_d=bb
ror_bb=iBB/BB(-1)+(p_bb-p_bb(-1))/p_bb(-1)
ror_bbe=ror_bbe(-1)+psi*(ror_bb(-1)-ror_bbe(-1))
ror_gb=iGB_ff/GB_ff(-1)+(p_gb-p_gb(-1))/p_gb(-1)
ror_gbe=ror_gbe(-1)+psi*(ror_gb(-1)-ror_gbe(-1))
ror_ef=div_f/E_f(-1)+(p_ef-p_ef(-1))/p_ef(-1)
ror_efe=ror_efe(-1)+psi*(ror_ef(-1)-ror_efe(-1))
bb=bb(-1)+bb_sb1+bb_sb2+bb_sb3
e_fd=((lambdaff30-lambdaff31*ror_gbe-lambdaff32*ror_bbe+lambdaff33*ror_efe-lambdaff34*r_dav)*(TAA_ffe))/p_ef
p_ef=((lambdaff30-lambdaff31*ror_gbe-lambdaff32*ror_bbe+lambdaff33*ror_efe-lambdaff34*r_dav)*(TAA_ffe))/e_f
e_ff=e_ffd
CARb1=(V_bb1)/(omega0*IBL_b1+omega1*M_b1ns+omega2*LL_b1+omega3*SL_b1)
V_bb1t=CARt*(omega0*IBL_b1+omega1*M_b1ns+omega2*LL_b1+omega3*SL_b1)
V_bb1te=V_bb1te(-1)+psi*(V_bb1t(-1)-V_bb1te(-1))
CARb1_e=CARb1_e(-1)+psi*(CARb1(-1)-CARb1_e(-1))
CARb2=(V_bb2)/(omega0*IBL_b2+omega1*M_b2ns+omega2*LL_b2+omega3*SL_b2)
V_bb2t=CARt*(omega0*IBL_b2+omega1*M_b2ns+omega2*LL_b2+omega3*SL_b2)
V_bb2te=V_bb2te(-1)+psi*(V_bb2t(-1)-V_bb2te(-1))
CARb2_e=CARb2_e(-1)+psi*(CARb2(-1)-CARb2_e(-1))
CARb3=(V_bb3)/(omega0*IBL_b3+omega1*M_b3ns+omega2*LL_b3+omega3*SL_b3)
V_bb3t=CARt*(omega0*IBL_b3+omega1*M_b3ns+omega2*LL_b3+omega3*SL_b3)
V_bb3te=V_bb3te(-1)+psi*(V_bb3t(-1)-V_bb3te(-1))
CARb3_e=CARb3_e(-1)+psi*(CARb3(-1)-CARb3_e(-1))
SFRb1=(omega10*D_hb1+omega11*D_ffb1+V_bb1)/(omega7*M_b1ns+omega8*LL_b1+omega9*SL_b1)
SFRb1_e=SFRb1_e(-1)+psi*(SFRb1(-1)-SFRb1_e(-1))
SFRb2=(omega10*D_hb2+omega11*D_ffb2+V_bb2)/(omega7*M_b2ns+omega8*LL_b2+omega9*SL_b2)
SFRb2_e=SFRb2_e(-1)+psi*(SFRb2(-1)-SFRb2_e(-1))
SFRb3=(omega10*D_hb3+omega11*D_ffb3+V_bb3)/(omega7*M_b3ns+omega8*LL_b3+omega9*SL_b3)
SFRb3_e=SFRb3_e(-1)+psi*(SFRb3(-1)-SFRb3_e(-1))
LCRb1=(R_b1)/(omega4*(D_b1))
LCRb2=(R_b2)/(omega5*(D_b2))
LCRb3=(R_b3)/(omega6*(D_b3))
#Government
Tax=tau*(W+div_ff+iD_h)
g=ifelse(u_e>u_n,g0+mu11*(u_n-u_e),g0+mu12*(u_n-u_e))
G=g*p
gb_s=max(0,PSBR/p_gb)
gb=gb(-1)+gb_s-rep_gbcb-rep_gbff
rep_gb=ifelse(PSBR<0, abs(PSBR)/p_gb, 0)
rep_gbcb=rep_gb*(gb_cb(-1)*p_gb(-1))/GB(-1)
rep_gbff=rep_gb*GB_ff(-1)/GB(-1)
GB=gb*p_gb
r_gb=max(r_cbl,r_cbl+mu2*gapy_e)
gap=min(PSBR/p_gb,PSBR/p_gb-(gb_d-gb_ff(-1)))
gapy=gap/Y
gapy_e=gapy_e(-1)+psi*(gapy(-1)-gapy_e(-1))
ror_gbt=roa_ff(-1)
p_gb=ror_gbt*p_gb(-1)-r_gb(-1)+p_gb(-1)
#Central Bank
pi=(p-p(-1))/p(-1)
r_cbd=r0+phi/2*(u(-1)-u_n)+phi/2*(pi(-1)-pit)
r_cbl=r_cbd+r1
R=R_lb1+R_lb2+R_lb3+A
gb_rcb=max(0,min(PSBR/p_gb, PSBR/p_gb-(gb_d-gb(-1))))
gb_cb=gb_cb(-1)+gb_rcb+gb_dcb-gb_scb-rep_gbcb
R_t=R_tb1+R_tb2+R_tb3
R_te=R_te(-1)+psi_cb*(R_t(-1)-R_te(-1))
R_p=R_pb1+R_pb2+R_pb3
R_pd=R_p+gb_scb*p_gb-gb_dcb*p_gb
R_pe=R_pe(-1)+psi_cb*(R_p(-1)-R_pe(-1))
R_pde=R_pde(-1)+psi_cb*(R_pd(-1)-R_pde(-1))
gb_dcb=max(0.9*(R_te-R_pde)/p_gb,0)
gb_scb=max(0,0.9*(R_pde-R_te)/p_gb)
CARt=ifelse(cyc==0,CARt0,ifelse(cyc==1, CARt0+2.1*(gDebtY(-1)+gDebtY(-2)+gDebtY(-3))/3,ifelse(cyc==2, CARt0+1.6*(gDebtY(-1)+gDebtY(-2))/2, CARt0-1.5*gDebt(-1))))
SFRt=ifelse(cyc2==0,SFRt0,SFRt0+0.008*((DebtY(-1)+DebtY(-2))/2)**1.6)
DebtY=((M_b1ns+M_b2ns+M_b3ns+SL_f+LL)/Y)
gDebtY=(DebtY-DebtY(-1))/DebtY(-1)
gDebt=((M_b1ns+M_b2ns+M_b3ns+SL_f+LL)-(M_b1ns(-1)+M_b2ns(-1)+M_b3ns(-1)+SL_f(-1)+LL(-1)))/(M_b1ns(-1)+M_b2ns(-1)+M_b3ns(-1)+SL_f(-1)+LL(-1))
INV=UC*Inv
INVacc=UC*(Inv-(Inv(-1)))
dep=delta_k*k(-1)
iBB=r_bb(-1)*bb(-1)
iBB_b1=r_bb(-1)*bb_b1(-1)
iBB_b2=r_bb(-1)*bb_b2(-1)
iBB_b3=r_bb(-1)*bb_b3(-1)
iGB=r_gb(-1)*gb(-1)
iGB_cb=r_gb(-1)*gb_cb(-1)
iGB_ff=r_gb(-1)*gb_ff(-1)
iIBA_b1=r_IB(-1)*IBA_b1(-1)
iIBA_b2=r_IB(-1)*IBA_b2(-1)
iIBA_b3=r_IB(-1)*IBA_b3(-1)
iIBL_b1=r_IB(-1)*IBL_b1(-1)
iIBL_b2=r_IB(-1)*IBL_b2(-1)
iIBL_b3=r_IB(-1)*IBL_b3(-1)
iIB_netb1=iIBL_b1-iIBA_b1
iIB_netb2=iIBL_b2-iIBA_b2
iIB_netb3=iIBL_b3-iIBA_b3
iCBA=r_cbl(-1)*A(-1)
iCBD=r_cbd(-1)*R(-1)
iCBA_b1=r_cbl(-1)*A_b1(-1)
iCBA_b2=r_cbl(-1)*A_b2(-1)
iCBA_b3=r_cbl(-1)*A_b3(-1)
iCBD_b1=r_cbd(-1)*R_b1(-1)
iCBD_b2=r_cbd(-1)*R_b2(-1)
iCBD_b3=r_cbd(-1)*R_b3(-1)
deltadep_h=D_h-D_h(-1)
deltadep_ff=D_ff-D_ff(-1)
deltadep_b1=D_b1-D_b1(-1)
deltadep_b2=D_b2-D_b2(-1)
deltadep_b3=D_b3-D_b3(-1)
deltaGB=p_gb*(gb-gb(-1))
deltaGB_ff=p_gb*(gb_ff-gb_ff(-1))
deltaGB_cb=p_gb*(gb_cb-gb_cb(-1))
deltaCBA=A-A(-1)
deltaCBA_b1=A_b1-A_b1(-1)
deltaCBA_b2=A_b2-A_b2(-1)
deltaCBA_b3=A_b3-A_b3(-1)
deltaR=R-R(-1)
deltaR_b1=R_b1-R_b1(-1)
deltaR_b2=R_b2-R_b2(-1)
deltaR_b3=R_b3-R_b3(-1)
deltaIBL_b1=IBL_b1-IBL_b1(-1)
deltaIBL_b2=IBL_b2-IBL_b2(-1)
deltaIBL_b3=IBL_b3-IBL_b3(-1)
deltaIBA_b1=IBA_b1-IBA_b1(-1)
deltaIBA_b2=IBA_b2-IBA_b2(-1)
deltaIBA_b3=IBA_b3-IBA_b3(-1)
deltaM=M_new-rep_m
deltaM_b1=(1-s_b1)*M_newb1-rep_mb1
deltaM_b2=(1-s_b2)*M_newb2-rep_mb2
deltaM_b3=(1-s_b3)*M_newb3-rep_mb3
deltaM_s=s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3-rep_ms
deltaLL=LL_sup-rep_LL
deltaLL_b1=LL_supb1-rep_LLb1
deltaLL_b2=LL_supb2-rep_LLb2
deltaLL_b3=LL_supb3-rep_LLb3
deltaSL_f=SL_f-SL_f(-1)
deltaSL_ff=SL_ff-SL_ff(-1)
deltaSL_b1=SL_b1-SL_b1(-1)
deltaSL_b2=SL_b2-SL_b2(-1)
deltaSL_b3=SL_b3-SL_b3(-1)
deltae_ff=e_ff-e_ff(-1)
BB=p_bb*bb
BB_b1=p_bb*bb_b1
BB_b2=p_bb*bb_b2
BB_b3=p_bb*bb_b3
deltaBB=p_bb*(bb-bb(-1))
deltaBB_b1=p_bb*(bb_b1-bb_b1(-1))
deltaBB_b2=p_bb*(bb_b2-bb_b2(-1))
deltaBB_b3=p_bb*(bb_b3-bb_b3(-1))
V_hlag=V_h(-1)
V_flag=V_f(-1)
V_b1lag=V_b1(-1)
V_b2lag=V_b2(-1)
V_b3lag=V_b3(-1)
V_fflag=V_ff(-1)
V_glag=V_g(-1)
V_cblag=V_cb(-1)
CG_h=(p_h-p_h(-1))*h+M_np
CG_f=(UC-UC(-1))*Inv(-1)+(p-p(-1))*(k(-1)-delta_k*k(-1))-(p_ef-p_ef(-1))*e_f-delta_k*k(-1)*p(-1)+LL_np
CG_b1=-(p_bb-p_bb(-1))*bb_b1(-1)-LL_npb1-M_npb1
CG_b2=-(p_bb-p_bb(-1))*bb_b2(-1)-LL_npb2-M_npb2
CG_b3=-(p_bb-p_bb(-1))*bb_b3(-1)-LL_npb3-M_npb3
CG_ff=(p_gb-p_gb(-1))*gb_ff(-1)+(p_ef-p_ef(-1))*e_f+(p_bb-p_bb(-1))*bb(-1)-M_nps
CG_g=-(p_gb-p_gb(-1))*gb(-1)
CG_cb=(p_gb-p_gb(-1))*gb_cb(-1)
GB_cb=p_gb*gb_cb
E_f=p_ef*e_f
H=p_h*h
dTAA_ffe=TAA_ffe-TAA_ffe(-1)
dror=ror_gbe-ror_gbe(-1)
dpgb=p_gb-p_gb(-1)
drgb=r_gb-r_gb(-1)
yieldBB=iBB/BB(-1)
CGBB=(p_bb-p_bb(-1))/p_bb(-1)
yieldEF=div_f/E_f(-1)
yieldEFalt=div_f/e_f
CGEF=(p_ef-p_ef(-1))/p_ef(-1)
yieldGB=iGB_ff/GB_ff(-1)
CGGB=(p_gb-p_gb(-1))/p_gb(-1)
#2. Parameters
sav_h = 9976.90637206672 
V_h = 2223813.32608377 
D_h = 631516.867826236 
YD = 339963.227763013 
M = 249981.682260276 
sav_f = 13091.6337411417 
V_f = -4798533.49378074 
SL_f = 400883.100604204 
K = 517887.123591471 
k = 16043.1135589734 
LL = 600380.535822466 
sav_b1 = 5326.03021889186 
Pr_b1 = 22789.6136595326 
Pr_b1e = 22802.9802412686 
V_b1 = -108786.31053242 
V_bb1 = 136023.467678128 
V_bb1e = 157486.973835882 
A_b1 = 0 
R_b1 = 20222.5644723921 
sav_b2 = 5326.03021889186 
Pr_b2 = 22789.6136595326 
Pr_b2e = 22802.9802412686 
V_b2 = -108786.31053242 
V_bb2 = 136023.467678128 
V_bb2e = 157486.973835882 
A_b2 = 0 
R_b2 = 20222.5644723921 
sav_b3 = 5326.03021889186 
Pr_b3 = 22789.6136595326 
Pr_b3e = 22802.9802412686 
V_b3 = -108786.31053242 
V_bb3 = 136023.467678128 
V_bb3e = 157486.973835882 
A_b3 = 0 
R_b3 = 20222.5644723921 
sav_ff = 17718.3313590263 
V_ff = 63479982.4431635 
SL_ff = 0 
D_ff = 222329.404791448 
M_s = 49996.3364520554 
sav_g = -24370.9638754218 
PSBR = 24370.9638754218 
V_g = -60847548.9607451 
PCB = -1927.07267986206 
sav_cb = 0 
V_cb = 1833506.81193406 
A = 0 
YD_e = 336700.490394933 
p_e = 31.2880211819123 
V_he = 2229215.64614272 
CG_he = 24867.3320717494 
c_d = 10222.320242816 
rr_d = 0.00611240574243888 
alpha1 = 0.736084816379842 
alpha2 = 0.0329127224569762 
rr_de = 0.0032299553366866 
C = 329986.321390946 
M_dem = 29210.7366569103 
H_dn = 64912.7481264673 
r_mav = 0.0765104533603922 
M_demb1 = 9736.91221897009 
M_demb2 = 9736.91221897009 
M_demb3 = 9736.91221897009 
H_def = 64432.6625988172 
H_s = 64432.6625988172 
p_h = 88.3341853640894 
lev_h = 0.101051898567624 
iM = 21880.2016320108 
iD_h = 12912.3874339949 
M_new = 28730.6511292602 
rep_m = 24638.8761840348 
M_np = 498.854525296103 
TAA_h = 1507305.06936178 
TAA_he = 1481309.63015958 
e_ffd = 875788.201535548 
ror_eff = 0.141105718782423 
ror_effe = 0.13884198751241 
D_hb1 = 210505.622608745 
D_hb2 = 210505.622608745 
D_hb3 = 210505.622608745 
N_s = 484.316402327153 
w = 19.0138032192651 
u_nw = 0.873657172078835 
u_e = 0.822872243456072 
p = 32.2809610296501 
UC = 21.4126761341361 
UC_e = 20.9826246692726 
W = 297265.581556903 
y = 13882.6917146989 
c = 10222.320242816 
N_d = 484.316402327153 
Y = 448146.630228843 
I = 33581.0875369184 
i_d = 1066.24549657574 
lev_f = 1.15928840180253 
r_LLav = 0.0837821403939283 
i = 1040.27533461826 
LL_d = 51008.7884998919 
LL_db1 = 17002.929499964 
LL_db2 = 17002.929499964 
LL_db3 = 17002.929499964 
c_e = 10486.5372088953 
Inv_t = 3494.49735716484 
Inv = 3758.71432324416 
SL_fdb1 = 133627.700201401 
SL_fdb2 = 133627.700201401 
SL_fdb3 = 133627.700201401 
u = 0.818597316396878 
Pr_f = 71514.6404677645 
sav_ft = 13091.6337411416 
div_f = 58423.0067266229 
rep_LL = 29680.992918032 
LL_np = 13728.7763339503 
iLL = 53763.0198008123 
iSL_f = 26205.9111542749 
iM_b1 = 5863.69343983579 
iLL_b1 = 17921.0066002708 
iSL_fb1 = 8735.30371809163 
iSL_ffb1 = 0 
iSL_b1 = 8735.30371809163 
iD_hb1 = 4304.12914466495 
iD_ffb1 = 1546.1243351705 
iD_b1 = 5850.25347983545 
iIB_b1 = 0 
fee_b1 = 191.537674195068 
M_b1ns = 66661.7819360739 
M_newb1 = 9576.88370975341 
xi1 = 0.983564757941959 
xi2 = 1 
rep_mb1 = 6570.36698240927 
M_npb1 = 133.027873412294 
LL_b1 = 200126.845274155 
LL_supb1 = 16723.4822379362 
rep_LLb1 = 9893.66430601067 
LL_npb1 = 4576.25877798343 
SL_fb1 = 133627.700201401 
SL_ffb1 = 0 
SL_b1 = 133627.700201401 
clear_b1 = -520.918304229519 
R_pb1 = 20222.5644723921 
R_tb1 = 18784.617997589 
R_anb1 = 1437.9464748031 
IBL_sb1 = 1437.9464748031 
IBA_db1 = 0 
IBL_sb1b2 = 0 
IBL_sb1b3 = 0 
IBL_b1b2 = 0 
IBL_b1b3 = 0 
IBA_b1b2 = 0 
IBA_b1b3 = 0 
IBL_b1 = 0 
IBA_b1 = 0 
R_lb1 = 20222.5644723921 
div_b1t = 22222.6223586297 
div_b1 = 22172.8700920365 
V_bb1pde = 135314.103743845 
bb_b1t = 1105.62280129791 
bb_b1te = 1100.60333943779 
bb_sb1 = 3.23965092675348 
bb_b1 = 1097.36368851104 
r_SLb1 = 0.0637821403939282 
r_LLcb1 = 0.0912195051258857 
r_LLb1 = 0.0837821403939282 
r_Mcb1 = 0.087801144202342 
r_Mb1 = 0.0765104533603917 
r_db1 = 0.0193067964893681 
D_b1 = 284615.424205895 
iM_b2 = 5863.69343983579 
iLL_b2 = 17921.0066002708 
iSL_fb2 = 8735.30371809163 
iSL_ffb2 = 0 
iSL_b2 = 8735.30371809163 
fee_b2 = 191.537674195068 
iD_hb2 = 4304.12914466495 
iD_ffb2 = 1546.1243351705 
iD_b2 = 5850.25347983545 
iIB_b2 = 0 
M_b2ns = 66661.7819360739 
M_newb2 = 9576.88370975341 
xi3 = 0.983564757941959 
xi4 = 1 
rep_mb2 = 6570.36698240927 
M_npb2 = 133.027873412294 
LL_b2 = 200126.845274155 
LL_supb2 = 16723.4822379362 
rep_LLb2 = 9893.66430601067 
LL_npb2 = 4576.25877798343 
SL_fb2 = 133627.700201401 
SL_ffb2 = 0 
SL_b2 = 133627.700201401 
clear_b2 = -520.918304229519 
R_pb2 = 20222.5644723921 
R_tb2 = 18784.617997589 
R_anb2 = 1437.9464748031 
IBL_sb2 = 1437.9464748031 
IBA_db2 = 0 
IBL_sb2b1 = 0 
IBL_sb2b3 = 0 
IBL_b2b1 = 0 
IBL_b2b3 = 0 
IBA_b2b1 = 0 
IBA_b2b3 = 0 
IBL_b2 = 0 
IBA_b2 = 0 
R_lb2 = 20222.5644723921 
bb_sb2 = 3.23965092675348 
bb_b2 = 1097.36368851104 
r_Mcb2 = 0.087801144202342 
r_Mb2 = 0.0765104533603917 
r_LLcb2 = 0.0912195051258857 
r_LLb2 = 0.0837821403939282 
r_SLb2 = 0.0637821403939282 
r_db2 = 0.0193067964893681 
D_b2 = 284615.424205895 
div_b2t = 22222.6223586297 
div_b2 = 22172.8700920365 
V_bb2pde = 135314.103743845 
bb_b2t = 1105.62280129791 
bb_b2te = 1100.60333943779 
iM_b3 = 5863.69343983579 
iLL_b3 = 17921.0066002708 
iSL_fb3 = 8735.30371809163 
iSL_ffb3 = 0 
iSL_b3 = 8735.30371809163 
fee_b3 = 191.537674195068 
iD_hb3 = 4304.12914466495 
iD_ffb3 = 1546.1243351705 
iD_b3 = 5850.25347983545 
iIB_b3 = 0 
M_b3ns = 66661.7819360739 
M_newb3 = 9576.88370975341 
xi5 = 0.983564757941959 
xi6 = 1 
rep_mb3 = 6570.36698240927 
M_npb3 = 133.027873412294 
LL_b3 = 200126.845274155 
LL_supb3 = 16723.4822379362 
rep_LLb3 = 9893.66430601067 
LL_npb3 = 4576.25877798343 
SL_fb3 = 133627.700201401 
SL_ffb3 = 0 
SL_b3 = 133627.700201401 
clear_b3 = -520.918304229519 
R_pb3 = 20222.5644723921 
R_tb3 = 18784.617997589 
R_anb3 = 1437.9464748031 
IBL_sb3 = 1437.9464748031 
IBA_db3 = 0 
IBL_sb3b1 = 0 
IBL_sb3b2 = 0 
IBL_b3b1 = 0 
IBL_b3b2 = 0 
IBA_b3b1 = 0 
IBA_b3b2 = 0 
IBL_b3 = 0 
IBA_b3 = 0 
R_lb3 = 20222.5644723921 
bb_sb3 = 3.23965092675348 
bb_b3 = 1097.36368851104 
r_Mcb3 = 0.087801144202342 
r_Mb3 = 0.0765104533603917 
r_LLcb3 = 0.0912195051258857 
r_LLb3 = 0.0837821403939282 
r_SLb3 = 0.0637821403939282 
r_db3 = 0.0193067964893681 
D_b3 = 284615.424205895 
div_b3t = 22222.6223586297 
div_b3 = 22172.8700920365 
V_bb3pde = 135314.103743845 
bb_b3t = 1105.62280129791 
bb_b3te = 1100.60333943779 
CAR = 0.468606404228075 
CAR_e = 0.46719326002243 
LL_sup = 50170.4467138087 
r_bb = 0.0690224140124601 
deltabbd = 9.71895278026068 
deltabbd_e = 11.5724397193346 
p_bb = 223.089009390059 
r_dav = 0.0193067964893681 
r_SLav = 0.0637821403939281 
r_IB = 0.0341842179671899 
IBS = 4313.8394244093 
IBD = 0 
div_b = 66518.6102761095 
Pr_ff = 140301.737294572 
div_ff = 122583.405935546 
iD_ff = 4638.3730055115 
iM_s = 4289.12131250344 
r_Mcs = 0.0856027879834356 
r_Ms = 0.0765104533603922 
fee = 574.613022585205 
iSL_ff = 0 
rep_ms = 4927.77523680696 
M_nps = 99.7709050592207 
SL_ffdb1 = 0 
SL_ffdb2 = 0 
SL_ffdb3 = 0 
D_ffb1 = 74109.8015971492 
D_ffb2 = 74109.8015971492 
D_ffb3 = 74109.8015971492 
TAA_ff = 64305774.308247 
TAA_ffe = 8631885.26800826 
TAA_fft = 8757882.01535548 
roa_ff = 0.00218179065260986 
gb_d = 3046.25393332207 
GB_d = 1297552.12512363 
gb_ff = 138404.419629956 
GB_ff = 58953374.455394 
bb_d = 3292.09106553311 
ror_bb = 0.00471566451171683 
ror_bbe = 0.00221096942373482 
ror_gb = 0.00216810867637719 
ror_gbe = 0.00212393844973319 
ror_ef = 0.0200102149097704 
ror_efe = 0.0174168235340493 
bb = 3292.09106553311 
e_fd = 17198.43 
p_ef = 255.583859307501 
e_ff = 875788.201535548 
CARb1 = 0.468606404228075 
V_bb1t = 137879.351549929 
V_bb1te = 135264.351477252 
CARb1_e = 0.46719326002243 
CARb2 = 0.468606404228075 
V_bb2t = 137879.351549929 
V_bb2te = 135264.351477252 
CARb2_e = 0.46719326002243 
CARb3 = 0.468606404228075 
V_bb3t = 137879.351549929 
V_bb3te = 135264.351477252 
CARb3_e = 0.46719326002243 
SFRb1 = 1.09694426522136 
SFRb1_e = 1.09875050552635 
SFRb2 = 1.09694426522136 
SFRb2_e = 1.09875050552635 
SFRb3 = 1.09694426522136 
SFRb3_e = 1.09875050552635 
LCRb1 = 0.645929487892306 
LCRb2 = 0.645929487892306 
LCRb3 = 0.645929487892306 
Tax = 70917.945531421 
g = 2675.53476044257 
G = 86368.8333353209 
gb_s = 57.2155392657385 
gb = 142851.359699338 
rep_gb = 0 
rep_gbcb = 0 
rep_gbff = 0 
GB = 60847548.9607451 
r_gb = 0.0474610660169462 
gap = 57.2155392657385 
gapy = 0.000127671470466088 
gapy_e = 0.000116207747127031 
ror_gbt = 0.00216810867637714 
p_gb = 425.950086081169 
pi = 0.0131142312445622 
r_cbd = 0.0341818470420028 
r_cbl = 0.0474237052262448 
R = 60667.6934171764 
gb_rcb = 57.2155392657385 
gb_cb = 4446.94006938241 
R_t = 56353.8539927671 
R_te = 55905.4943607279 
R_p = 60667.6934171764 
R_pd = 84456.6281357118 
R_pe = 59961.0781543183 
R_pde = 82337.6440479894 
gb_dcb = 0 
gb_scb = 55.8491135367494 
DebtY = 2.68048201460643 
gDebtY = 0.000869901686446698 
gDebt = 0.0070824254050242 
INV = 80484.1324843658 
INVacc = -1187.08928342988 
dep = 1108.32762580243 
iBB = 231.946994463257 
iBB_b1 = 77.3156648210857 
iBB_b2 = 77.3156648210857 
iBB_b3 = 77.3156648210857 
iGB = 6993.0033916598 
iGB_cb = 217.711389712817 
iGB_ff = 6775.292001947 
iIBA_b1 = 0 
iIBA_b2 = 0 
iIBA_b3 = 0 
iIBL_b1 = 0 
iIBL_b2 = 0 
iIBL_b3 = 0 
iIB_netb1 = 0 
iIB_netb2 = 0 
iIB_netb3 = 0 
iCBA = 0 
iCBD = 2144.78406957487 
iCBA_b1 = 0 
iCBA_b2 = 0 
iCBA_b3 = 0 
iCBD_b1 = 714.928023191625 
iCBD_b2 = 714.928023191625 
iCBD_b3 = 714.928023191625 
deltadep_h = 7014.97894518985 
deltadep_ff = -2003.44752450896 
deltadep_b1 = 1670.51047356031 
deltadep_b2 = 1670.51047356031 
deltadep_b3 = 1670.51047356031 
deltaGB = 24370.9638754242 
deltaGB_ff = 23788.93471853 
deltaGB_cb = 582.029156886503 
deltaCBA = 0 
deltaCBA_b1 = 0 
deltaCBA_b2 = 0 
deltaCBA_b3 = 0 
deltaR = 582.02915688631 
deltaR_b1 = 194.009718962105 
deltaR_b2 = 194.009718962105 
deltaR_b3 = 194.009718962105 
deltaIBL_b1 = 0 
deltaIBL_b2 = 0 
deltaIBL_b3 = 0 
deltaIBA_b1 = 0 
deltaIBA_b2 = 0 
deltaIBA_b3 = 0 
deltaM = 4091.77494522548 
deltaM_b1 = 1091.13998539346 
deltaM_b2 = 1091.13998539346 
deltaM_b3 = 1091.13998539346 
deltaM_s = 818.354989045093 
deltaLL = 20489.4537957767 
deltaLL_b1 = 6829.81793192557 
deltaLL_b2 = 6829.81793192557 
deltaLL_b3 = 6829.81793192557 
deltaSL_f = -1187.0892834299 
deltaSL_ff = 0 
deltaSL_b1 = -395.696427809948 
deltaSL_b2 = -395.696427809948 
deltaSL_b3 = -395.696427809948 
deltae_ff = 7053.7023721023 
BB = 734429.334631645 
BB_b1 = 244809.778210548 
BB_b2 = 244809.778210548 
BB_b3 = 244809.778210548 
deltaBB = 2168.19154805711 
deltaBB_b1 = 722.730516019021 
deltaBB_b2 = 722.730516019021 
deltaBB_b3 = 722.730516019021 
V_hlag = 2187483.99596155 
V_flag = -4767957.24497333 
V_b1lag = -108334.37666043 
V_b2lag = -108334.37666043 
V_b3lag = -108334.37666043 
V_fflag = 63309473.8351215 
V_glag = -60698569.9042084 
V_cblag = 1829627.41998995 
CG_h = 26352.4237501461 
CG_f = -43667.8825485498 
CG_b1 = -5777.96409088161 
CG_b2 = -5777.96409088161 
CG_b3 = -5777.96409088161 
CG_ff = 152790.276682986 
CG_g = -124608.092661342 
CG_cb = 3879.39194411362 
GB_cb = 1894174.50535124 
E_f = 4395641.11342991 
H = 966489.938982258 
dTAA_ffe = 55459.7236261889 
dror = 2.61374443947093e-05 
dpgb = 0.872641475561181 
drgb = -0.00151155420353449 
yieldBB = 0.000318147408938445 
CGBB = 0.00439751710277839 
yieldEF = 0.0133792558973765 
yieldEFalt = 3.396996512276 
CGEF = 0.00663095901239385 
yieldGB = 0.00011520870100722 
CGGB = 0.00205289997536997 
alpha1L = 0.65 
alpha1U = 0.75 
alpha2L = 0.02 
alpha2U = 0.035 
sigmampc1 = 55 
sigmampc2 = 2 
rho0 = 15151.74 
rho1 = 0.04452939 
rho2 = 100823.8 
rho3 = 53046.65 
lambdamr1 = rnorm(1,1/3,0.04)
lambdamr2 = rnorm(1,1/3,0.04)
lambdamr3 = rnorm(1,1/3,0.04)
lambdamr4 = lambdamr1+lambdamr2+lambdamr3
lambdam11 =ifelse(rand==1, lambdamr1/lambdamr4, 1/3)
lambdam12 =ifelse(rand==1, lambdamr2/lambdamr4, 1/3)
lambdam13 =ifelse(rand==1, lambdamr3/lambdamr4, 1/3)
lambdam2 = 1.25
eta = 0.0666666666666667 
lambdaeff10 = 0.5912795 
lambdaeff11 = 0.05 
lambdaeff12 = 0.05 
lambdaeff13 = 0.05 
lambdadhr1 = rnorm(1,1/3,0.04)
lambdadhr2 = rnorm(1,1/3,0.04)
lambdadhr3 = rnorm(1,1/3,0.04)
lambdadhr4 = lambdadhr1+lambdadhr2+lambdadhr3
lambdadh11 =ifelse(rand==1, lambdadhr1/lambdadhr4, 1/3)
lambdadh12 =ifelse(rand==1, lambdadhr2/lambdadhr4, 1/3)
lambdadh13 =ifelse(rand==1, lambdadhr3/lambdadhr4, 1/3)
lambdadffr1 = rnorm(1,1/3,0.04)
lambdadffr2 = rnorm(1,1/3,0.04)
lambdadffr3 = rnorm(1,1/3,0.04)
lambdadffr4 = lambdadffr1+lambdadffr2+lambdadffr3
lambdadff11 =ifelse(rand==1, lambdadffr1/lambdadffr4, 1/3)
lambdadff12 =ifelse(rand==1, lambdadffr2/lambdadffr4, 1/3)
lambdadff13 =ifelse(rand==1, lambdadffr3/lambdadffr4, 1/3)
lambdadh2 = 1.25
lambdadff2 = 1.25
beta1 = 0.11 
theta = 0.538461538461538 
kappa = 0.95 
alpha = 28.6645086724138 
gamma0 = 1500 
gammau = 2100 
gammal = 3500 
lambdallr1 = rnorm(1,1/3,0.04)
lambdallr2 = rnorm(1,1/3,0.04)
lambdallr3 = rnorm(1,1/3,0.04)
lambdallr4 =lambdallr1+lambdallr2+lambdallr3
lambdall11 =ifelse(rand==1, lambdallr1/lambdallr4, 1/3)
lambdall12 =ifelse(rand==1, lambdallr2/lambdallr4, 1/3)
lambdall13 =ifelse(rand==1, lambdallr3/lambdallr4, 1/3)
lambdall2 = 1.25
gamma1 = 0.25 
lambdaslfr1 = rnorm(1,1/3,0.04)
lambdaslfr2 = rnorm(1,1/3,0.04)
lambdaslfr3 = rnorm(1,1/3,0.04)
lambdaslfr4 = lambdaslfr1+lambdaslfr2+lambdaslfr3
lambdaslf11 =ifelse(rand==1, lambdaslfr1/lambdaslfr4, 1/3)
lambdaslf12 =ifelse(rand==1, lambdaslfr2/lambdaslfr4, 1/3) 
lambdaslf13 =ifelse(rand==1, lambdaslfr3/lambdaslfr4, 1/3)
lambdaslffr1 = rnorm(1,1/3,0.04)
lambdaslffr2 = rnorm(1,1/3,0.04)
lambdaslffr3 = rnorm(1,1/3,0.04)
lambdaslffr4 = lambdaslffr1+lambdaslffr2+lambdaslffr3
lambdaslff11 =ifelse(rand==1, lambdaslffr1/lambdaslffr4, 1/3)
lambdaslff12 =ifelse(rand==1, lambdaslffr2/lambdaslffr4, 1/3) 
lambdaslff13 =ifelse(rand==1, lambdaslffr3/lambdaslffr4, 1/3)
lambdaslf2 = 1.25
lambdaslff2 = 1.25
rand = 0
cyc = 0
cyc2 = 0
s_b1 = 0.2 
s_b2 = 0.2 
s_b3 = 0.2 
chi_mb1 = 0.1 
zeta_mb1 = 0.02 
chi_mb2 = 0.1 
zeta_mb2 = 0.02 
chi_mb3 = 0.1 
zeta_mb3 = 0.02 
chi_ms = 0.1 
zeta_ms = 0.02 
chi_LLb1 = 0.05 
zeta_LLb1 = 0.02 
chi_LLb2 = 0.05 
zeta_LLb2 = 0.02 
chi_LLb3 = 0.05 
zeta_LLb3 = 0.02 
epsiloncarbb = 0.5 
epsilonsl1 = 0.03 
epsilonsl2 = 0.03 
epsilonsl3 = 0.03 
epsiloncarsl = 0.15 
epsilonsfrsl = 0.15 
epsilonr = 0.5 
epsilonll1 = 0.05 
epsilonll2 = 0.05 
epsilonll3 = 0.05 
epsiloncarll = 0.15 
epsilonsfrll = 0.15 
epsilonm1 = 0.04 
epsilonm2 = 0.04 
epsilonm3 = 0.04 
epsiloncarm = 0.12 
epsilonsfrm = 0.12 
epsilond1 = -0.005 
epsilond2 = -0.005 
epsilond3 = -0.005 
epsilonsfrd = 0.1 
lambdaff10 = 0.15127968 
lambdaff11 = 0.1 
lambdaff12 = 0.04 
lambdaff13 = 0.04 
lambdaff14 = 0.02 
lambdaff20 = 0.0855549 
lambdaff21 = 0.04 
lambdaff22 = 0.07 
lambdaff23 = 0.02 
lambdaff24 = 0.01 
lambdaff30 = 0.5083361 
lambdaff31 = 0.04 
lambdaff32 = 0.02 
lambdaff33 = 0.07 
lambdaff34 = 0.01 
omega0 = 0.2 
omega1 = 0.35 
omega2 = 1 
omega3 = 0.5 
omega4 = 0.11 
omega5 = 0.11 
omega6 = 0.11 
omega12 = 0.02 
omega13 = 0.2 
omega7 = 1 
omega8 = 1 
omega9 = 0.5 
omega10 = 0.925 
omega11 = 0.475 
mu11 = 3250 
mu12 = 6500 
mu1 = 9750 
mu2 = 0.3215 
mu3 = 2.5e-06 
phiu = 0.3 
phipi = 0.3 
phi = 0.6 
sigmaIB = 0.000001
psi = 0.5 
psi_cb = 0.75 
psi_gb = 0.4 
psi_ff = 0.3 
iota_ff = 0.1 
psiu = 0.0475 
delta_k = 0.0687925154585626 
LTV = 0.45 
u_n = 0.865262206601083 
h = 10941.29 
e_f = 17198.43 
lev_ft = 1.2 
tau = 0.163873094135249 
pit = 0 
f = 0.1 
f_f = 0.775 
f_ff = 0.9 
CARt0 = 0.475 
SFRt0 = 1 
LCRt = 0.6 
g0 = 2400 
r0 = 0.042852 
r1 = 0.013241858184242 
AE_ff = 1.910862 
AE_fft = 10 
gap_e = -163.707523945783 
delta_u = 0 
delta_ue = 0 
#4.Timeline
timeline 1 500
