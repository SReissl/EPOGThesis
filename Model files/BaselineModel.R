# 1. Equations
# 1.1 Identities
# Households
sav_h=W+div_ff+iD_h-C-Tax-iM
V_h=D_h+p_h*h+e_ff-M
D_h=D_h(-1)+sav_h+M_new-rep_m-(e_ff-e_ff(-1))
YD=W+div_ff+iD_h-Tax-iM
M=M(-1)+M_new-rep_m-M_np
#Firms
sav_f=C+I+UC*(Inv-Inv(-1))+G-W-div_f-iLL-iSL_f
V_f=K+UC*Inv-LL-SL_f-p_ef*e_f
SL_f=SL_f(-1)+I-sav_f-LL_sup+rep_LL+(Inv-Inv(-1))*UC
K=k(-1)*p(-1)-delta_k*k(-1)*p(-1)+(p-p(-1))*(k(-1)-delta_k*k(-1))+i*p
k=k(-1)+i-delta_k*k(-1)
LL=LL(-1)+LL_sup-rep_LL-LL_np
#Banks
#Bank 1
sav_b1=iM_b1+fee_b1+iLL_b1+iSL_b1+iIB_b1+r_cbd(-1)*R_b1(-1)-iD_b1-r_bb(-1)*bb_b1(-1)-r_cbl(-1)*A_b1(-1)-div_b1
Pr_b1=iM_b1+fee_b1+iLL_b1+iSL_b1+iIB_b1+r_cbd(-1)*R_b1(-1)-iD_b1-r_bb(-1)*bb_b1(-1)-r_cbl(-1)*A_b1(-1)-M_npb1-LL_npb1
Pr_b1e=Pr_b1e(-1)+psi*(Pr_b1(-1)-Pr_b1e(-1))
V_b1=R_b1+LL_b1+SL_b1+M_b1ns+IBL_b1-D_b1-IBA_b1-A_b1-p_bb*bb_b1
V_bb1=R_b1+LL_b1+SL_b1+M_b1ns+IBL_b1-D_b1-IBA_b1-A_b1
V_bb1e=V_bb1(-1)+Pr_b1e
A_b1=max(R_tb1-R_lb1,0)
R_b1=R_pb1+IBA_b1-IBL_b1+A_b1
#Bank 2
sav_b2=iM_b2+fee_b2+iLL_b2+iSL_b2+iIB_b2+r_cbd(-1)*R_b2(-1)-iD_b2-r_bb(-1)*bb_b2(-1)-r_cbl(-1)*A_b2(-1)-div_b2
Pr_b2=iM_b2+fee_b2+iLL_b2+iSL_b2+iIB_b2+r_cbd(-1)*R_b2(-1)-iD_b2-r_bb(-1)*bb_b2(-1)-r_cbl(-1)*A_b2(-1)-M_npb2-LL_npb2
Pr_b2e=Pr_b2e(-1)+psi*(Pr_b2(-1)-Pr_b2e(-1))
V_b2=R_b2+LL_b2+SL_b2+M_b2ns+IBL_b2-D_b2-IBA_b2-A_b2-p_bb*bb_b2
V_bb2=R_b2+LL_b2+SL_b2+M_b2ns+IBL_b2-D_b2-IBA_b2-A_b2
V_bb2e=V_bb2(-1)+Pr_b2e
A_b2=max(R_tb2-R_lb2,0)
R_b2=R_pb2+IBA_b2-IBL_b2+A_b2
#Bank 3
sav_b3=iM_b3+fee_b3+iLL_b3+iSL_b3+iIB_b3+r_cbd(-1)*R_b3(-1)-iD_b3-r_bb(-1)*bb_b3(-1)-r_cbl(-1)*A_b3(-1)-div_b3
Pr_b3=iM_b3+fee_b3+iLL_b3+iSL_b3+iIB_b3+r_cbd(-1)*R_b3(-1)-iD_b3-r_bb(-1)*bb_b3(-1)-r_cbl(-1)*A_b3(-1)-M_npb3-LL_npb3
Pr_b3e=Pr_b3e(-1)+psi*(Pr_b3(-1)-Pr_b3e(-1))
V_b3=R_b3+LL_b3+SL_b3+M_b3ns+IBL_b3-D_b3-IBA_b3-A_b3-p_bb*bb_b3
V_bb3=R_b3+LL_b3+SL_b3+M_b3ns+IBL_b3-D_b3-IBA_b3-A_b3
V_bb3e=V_bb3(-1)+Pr_b3e
A_b3=max(R_tb3-R_lb3,0)
R_b3=R_pb3+IBA_b3-IBL_b3+A_b3
#Financial Firms
sav_ff=div_f+iM_s+r_bb(-1)*bb(-1)+r_gb(-1)*gb_ff(-1)+iD_ff+div_b-div_ff-fee-iSL_ff
V_ff=GB_ff+p_ef*e_f+p_bb*bb+D_ff+M_s-SL_ff-e_ff
SL_ff=ifelse(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)>=p_bb*(bb-bb(-1))+(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)-rep_ms-p_gb*rep_gbff+p_gb*(gb_s-gb_rcb)-p_gb*gb_dcb+p_gb*gb_scb+SL_ff(-1),0,-(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)-p_bb*(bb-bb(-1))-(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)+rep_ms+p_gb*rep_gbff-p_gb*(gb_s-gb_rcb)+p_gb*gb_dcb-p_gb*gb_scb-SL_ff(-1)))
D_ff=ifelse(sav_ff+(e_ff-e_ff(-1))+D_ff(-1)>=p_bb*(bb-bb(-1))+(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)-rep_ms-p_gb*rep_gbff+p_gb*(gb_s-gb_rcb)-p_gb*gb_dcb+p_gb*gb_scb+SL_ff(-1),sav_ff+(e_ff-e_ff(-1))+D_ff(-1)-p_bb*(bb-bb(-1))-(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3)+rep_ms+p_gb*rep_gbff-p_gb*(gb_s-gb_rcb)+p_gb*gb_dcb-p_gb*gb_scb-SL_ff(-1),0)
M_s=M_s(-1)+s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3-rep_ms-M_nps
#Government
sav_g=Tax+PCB-G-r_gb(-1)*gb(-1)
PSBR=G+r_gb(-1)*gb(-1)-Tax-PCB
V_g=-GB
#Central Bank
PCB=r_gb(-1)*gb_cb(-1)+r_cbl(-1)*A(-1)-r_cbd(-1)*R(-1)
sav_cb=r_gb(-1)*gb_cb(-1)+r_cbl(-1)*A(-1)-r_cbd(-1)*R(-1)-PCB
V_cb=GB_cb+A-R
A=A_b1+A_b2+A_b3
#1.2 Behavioural equations
#Households
YD_e=YD_e(-1)+psi*(YD(-1)-YD_e(-1))
p_e=p_e(-1)+psi*(p(-1)-p_e(-1))
V_he=V_h(-1)+(YD_e-c_d*p_e)+CG_he
CG_he=(p_h(-1)-p_h(-2))*h
c_d=alpha1*YD_e/p_e+alpha2*V_h(-1)/p_e
rr_d=(1+r_dav)/(1+pi)-1
alpha1=alpha1L+((alpha1U-alpha1L)/(1+exp(sigmampc1*rr_de-sigmampc2)))
alpha2=alpha2L+((alpha2U-alpha2L)/(1+exp(sigmampc1*rr_de-sigmampc2)))
rr_de=rr_de(-1)+psi*(rr_d(-1)-rr_de(-1))
C=c*p
M_dem=LTV*H_dn
H_dn=rho0+rho1*V_he-rho2*LTV-rho3*r_mav(-1)
r_mav=r_Mb1*(M_b1ns(-1)/M(-1))+r_Mb2*(M_b2ns(-1)/M(-1))+r_Mb3*(M_b3ns(-1)/M(-1))+r_Ms*(M_s(-1)/M(-1))
M_demb1=(lambdam11+lambdam2*(r_Mb2-r_Mb1)+lambdam2*(r_Mb3-r_Mb1))*M_dem
M_demb2=(lambdam12+lambdam2*(r_Mb1-r_Mb2)+lambdam2*(r_Mb3-r_Mb2))*M_dem
M_demb3=(lambdam13+lambdam2*(r_Mb1-r_Mb3)+lambdam2*(r_Mb2-r_Mb3))*M_dem
H_def=ifelse(M_dem>M_new, M_new+(1-LTV)*H_dn, H_dn)
H_s=eta*p_h*h
p_h=H_def/(eta*h)
lev_h=M/(p_h*h+D_h+e_ff)
iM=iM_b1+iM_b2+iM_b3+iM_s
iD_h=iD_hb1+iD_hb2+iD_hb3
M_new=M_newb1+M_newb2+M_newb3
rep_m=rep_mb1+rep_mb2+rep_mb3+rep_ms
M_np=M_npb1+M_npb2+M_npb3+M_nps
TAA_h=D_h+e_ff
TAA_he=TAA_he(-1)+psi*(TAA_h(-1)-TAA_he(-1))
e_ffd=(lambdaeff10-lambdaeff11*r_dav+lambdaeff12*ror_effe)*TAA_he-lambdaeff13*YD_e
ror_eff=div_ff/e_ff(-1)
ror_effe=ror_effe(-1)+psi*(ror_eff(-1)-ror_effe(-1))
D_hb1=(lambdadh11+lambdadh2*(r_db1-r_db2)+lambdadh2*(r_db1-r_db3))*D_h
D_hb2=(lambdadh12+lambdadh2*(r_db2-r_db1)+lambdadh2*(r_db2-r_db3))*D_h
D_hb3=(lambdadh13+lambdadh2*(r_db3-r_db1)+lambdadh2*(r_db3-r_db2))*D_h
N_s=N_d
w=w(-1)*(1+beta1*(u_e-u_nw))
u_nw=u_nw(-1)+psiu*(u(-1)-u_nw(-1))
u_e=u_e(-1)+psi*(u(-1)-u_e(-1))
#Firms
p=(1+theta)*UC_e
UC=W/y
UC_e=UC_e(-1)+psi*(UC(-1)-UC_e(-1))
W=w*p*N_d
y=min(k(-1)/kappa, c_e+i+g+(Inv_t-Inv(-1)))
c=ifelse(c_d+i+g<=k(-1)/kappa+Inv(-1), min(c_d, c_e+Inv_t), y-i-g+Inv(-1))
N_d=y/alpha
Y=y*p
I=i*p
i_d=gamma0+gammau*(u_e-u_n)-gammal*lev_f(-1)*r_LLav(-1)
lev_f=(LL)/(K)
r_LLav=r_LLb1*(LL_b1(-1)/LL(-1))+r_LLb2*(LL_b2(-1)/LL(-1))+r_LLb3*(LL_b3(-1)/LL(-1))
i=ifelse(LL_d>LL_sup, (sav_ft+LL_sup-rep_LL)/p, i_d)
LL_d=max(0,p*i_d-sav_ft+rep_LL)
LL_db1=(lambdall11+lambdall2*(r_LLb1-r_LLb2)+lambdall2*(r_LLb1-r_LLb3))*LL_d
LL_db2=(lambdall12+lambdall2*(r_LLb2-r_LLb1)+lambdall2*(r_LLb2-r_LLb3))*LL_d
LL_db3=(lambdall13+lambdall2*(r_LLb3-r_LLb2)+lambdall2*(r_LLb3-r_LLb2))*LL_d
c_e=c_e(-1)+psi*(c(-1)-c_e(-1))
Inv_t=gamma1*y(-1)
Inv=Inv(-1)+y-c-i-g
SL_fdb1=(lambdaslf11+lambdaslf2*(r_SLb2-r_SLb1)+lambdaslf2*(r_SLb3-r_SLb1))*SL_f
SL_fdb2=(lambdaslf12+lambdaslf2*(r_SLb1-r_SLb2)+lambdaslf2*(r_SLb3-r_SLb2))*SL_f
SL_fdb3=(lambdaslf13+lambdaslf2*(r_SLb1-r_SLb3)+lambdaslf2*(r_SLb2-r_SLb3))*SL_f
u=y/(k(-1)/kappa)
Pr_f=C+I+G+UC*(Inv-Inv(-1))-W-iLL-iSL_f
sav_ft=max(0,LL(-1)+p*i_d-lev_ft*(K(-1)+p*i_d-p(-1)*delta_k*k(-1)))
div_f=max(0,Pr_f-sav_ft)
rep_LL=rep_LLb1+rep_LLb2+rep_LLb3
LL_np=LL_npb1+LL_npb2+LL_npb3
iLL=iLL_b1+iLL_b2+iLL_b3
iSL_f=iSL_fb1+iSL_fb2+iSL_fb3
#Banks
#Bank 1
iM_b1=r_Mcb1(-1)*(M_b1ns(-1)-M_npb1)
iLL_b1=r_LLcb1(-1)*(LL_b1(-1)-LL_npb1)
iSL_fb1=r_SLb1(-1)*SL_fb1(-1)
iSL_ffb1=r_SLb1(-1)*SL_ffb1(-1)
iSL_b1=iSL_fb1+iSL_ffb1
iD_hb1=r_db1(-1)*D_hb1(-1)
iD_ffb1=r_db1(-1)*D_ffb1(-1)
iD_b1=iD_hb1+iD_ffb1
iIB_b1=r_IB(-1)*(IBL_b1(-1)-IBA_b1(-1))
fee_b1=f*s_b1*M_newb1
M_b1ns=M_b1ns(-1)+(1-s_b1)*M_newb1-rep_mb1-M_npb1
M_newb1=min(xi1*M_demb1,xi2*M_demb1)
xi1=ifelse(CARb1_e/CARt<1, CARb1_e/CARt, 1)
xi2=ifelse(SFRb1_e/SFRt<1, SFRb1_e/SFRt, 1)
rep_mb1=chi_mb1*M_b1ns(-1) 
M_npb1=zeta_mb1*lev_h(-1)*M_b1ns(-1)
LL_b1=LL_b1(-1)+LL_supb1-rep_LLb1-LL_npb1
LL_supb1=min(xi1*LL_db1,xi2*LL_db1)
rep_LLb1=chi_LLb1*LL_b1(-1)
LL_npb1=zeta_LLb1*lev_f(-1)*LL_b1(-1)
SL_fb1=SL_fdb1
SL_ffb1=SL_ffdb1
SL_b1=SL_fdb1+SL_ffdb1
clear_b1=(D_b1-D_b1(-1))+rep_LLb1+rep_mb1-LL_supb1-(SL_b1-SL_b1(-1))-(1-s_b1)*M_newb1+iLL_b1+iSL_b1+iM_b1-iD_b1-iBB_b1+p_bb*(bb_b1-bb_b1(-1))+fee_b1-div_b1
R_pb1=R_b1(-1)+clear_b1+IBL_b1(-1)-IBA_b1(-1)-A_b1(-1)-r_IB(-1)*IBA_b1(-1)+r_IB(-1)*IBL_b1(-1)-r_cbl(-1)*A_b1(-1)+r_cbd(-1)*R_b1(-1)
R_tb1=LCRt*omega4*D_b1
R_anb1=R_pb1-R_tb1
IBL_sb1=ifelse(R_anb1>0,R_anb1,0)
IBA_db1=ifelse(R_anb1<0,abs(R_anb1),0)
IBL_sb1b2=ifelse(IBA_db2>=IBL_sb1+IBL_sb3&IBL_sb3>0&IBL_sb1>0,IBL_sb1,ifelse(IBA_db2<IBL_sb1+IBL_sb3&IBL_sb1>0&IBL_sb3>0,IBA_db2*(IBL_sb1/(IBL_sb1+IBL_sb3)),ifelse(IBA_db2+IBA_db3>=IBL_sb1&IBL_sb1>0&IBA_db3>0,IBL_sb1*(IBA_db2/(IBA_db2+IBA_db3)),ifelse(IBA_db2+IBA_db3<IBL_sb1&IBL_sb1>0,IBA_db2,0))))
IBL_sb1b3=ifelse(IBA_db3>=IBL_sb1+IBL_sb2&IBL_sb2>0&IBL_sb1>0,IBL_sb1,ifelse(IBA_db3<IBL_sb1+IBL_sb2&IBL_sb1>0&IBL_sb2>0,IBA_db3*(IBL_sb1/(IBL_sb1+IBL_sb2)),ifelse(IBA_db3+IBA_db2>=IBL_sb1&IBL_sb1>0&IBA_db2>0,IBL_sb1*(IBA_db3/(IBA_db3+IBA_db2)),ifelse(IBA_db3+IBA_db2<IBL_sb1&IBL_sb1>0,IBA_db3,0))))
IBL_b1b2=IBL_sb1b2
IBL_b1b3=IBL_sb1b3
IBA_b1b2=IBL_sb2b1
IBA_b1b3=IBL_sb3b1
IBL_b1=IBL_b1b2+IBL_b1b3
IBA_b1=IBA_b1b2+IBA_b1b3
R_lb1=R_pb1+IBA_b1-IBL_b1
div_b1t=max(0,V_bb1e-V_bb1te)
div_b1=max(0,div_b1(-1)+psi*(div_b1t-div_b1(-1)))
V_bb1pde=V_bb1(-1)+Pr_b1e-div_b1
bb_b1t=max(100,bb_b1(-1)+(CARt*(omega2*LL_b1+omega3*SL_b1+omega1*M_b1ns+omega0*IBL_b1)-V_bb1pde)/p_bb)
bb_b1te=bb_b1te(-1)+psi*(bb_b1t(-1)-bb_b1te(-1))
bb_sb1=epsiloncarbb*(bb_b1te-bb_b1(-1))
bb_b1=bb_b1(-1)+bb_sb1
r_SLb1=r_cbl+epsilonsl1+epsilonsfrsl*(SFRt-SFRb1_e)+epsiloncarsl*(CARt-CARb1_e)+epsilonr*(r_SLav(-1)-r_SLb1(-1))
r_LLcb1=ifelse(cr==1, (r_LLb1(-1)*LL_b1(-1)+r_LLb1*LL_supb1)/LL_b1, (r_LLb1(-1)*(LL_b1(-1)-rep_LLb1-LL_npb1)+r_LLb1*LL_supb1)/LL_b1)
r_LLb1=r_cbl+epsilonll1+epsilonsfrll*(SFRt-SFRb1_e)+epsiloncarll*(CARt-CARb1_e)+epsilonr*(r_LLav(-1)-r_LLb1(-1))
r_Mcb1=ifelse(cr==1, (r_Mb1(-1)*M_b1ns(-1)+r_Mb1*M_newb1)/M_b1ns, (r_Mb1(-1)*(M_b1ns(-1)-rep_mb1-M_npb1)+r_Mb1*(1-s_b1)*M_newb1)/M_b1ns)
r_Mb1=r_cbl+epsilonm1+epsilonsfrm*(SFRt-SFRb1_e)+epsiloncarm*(CARt-CARb1_e)+epsilonr*(r_mav(-1)-r_Mb1(-1))
r_db1=r_cbd+epsilond1+epsilonr*(r_dav(-1)-r_db1(-1))+epsilonsfrd*(SFRt-SFRb1_e)
D_b1=D_hb1+D_ffb1
#Bank 2
iM_b2=r_Mcb2(-1)*(M_b2ns(-1)-M_npb2)
iLL_b2=r_LLcb2(-1)*(LL_b2(-1)-LL_npb2)
iSL_fb2=r_SLb2(-1)*SL_fb2(-1)
iSL_ffb2=r_SLb2(-1)*SL_ffb2(-1)
iSL_b2=iSL_fb2+iSL_ffb2
fee_b2=f*s_b2*M_newb2
iD_hb2=r_db2(-1)*D_hb2(-1)
iD_ffb2=r_db2(-1)*D_ffb2(-1)
iD_b2=iD_hb2+iD_ffb2
iIB_b2=r_IB(-1)*(IBL_b2(-1)-IBA_b2(-1))
M_b2ns=M_b2ns(-1)+(1-s_b2)*M_newb2-rep_mb2-M_npb2
M_newb2=min(xi3*M_demb2,xi4*M_demb2)
xi3=ifelse(CARb2_e/CARt<1, CARb2_e/CARt, 1)
xi4=ifelse(SFRb2_e/SFRt<1, SFRb2_e/SFRt, 1)
rep_mb2=chi_mb2*M_b2ns(-1)
M_npb2=zeta_mb2*lev_h(-1)*M_b2ns(-1)
LL_b2=LL_b2(-1)+LL_supb2-rep_LLb2-LL_npb2
LL_supb2=min(xi3*LL_db2,xi4*LL_db2)
rep_LLb2=chi_LLb2*LL_b2(-1)
LL_npb2=zeta_LLb2*lev_f(-1)*LL_b2(-1)
SL_fb2=SL_fdb2
SL_ffb2=SL_ffdb2
SL_b2=SL_fdb2+SL_ffdb2
clear_b2=(D_b2-D_b2(-1))+rep_LLb2+rep_mb2-LL_supb2-(SL_b2-SL_b2(-1))-(1-s_b2)*M_newb2+iLL_b2+iSL_b2+iM_b2-iD_b2-iBB_b2+p_bb*(bb_b2-bb_b2(-1))+fee_b2-div_b2
R_pb2=R_b2(-1)+clear_b2+IBL_b2(-1)-IBA_b2(-1)-A_b2(-1)-r_IB(-1)*IBA_b2(-1)+r_IB(-1)*IBL_b2(-1)-r_cbl(-1)*A_b2(-1)+r_cbd(-1)*R_b2(-1)
R_tb2=LCRt*omega5*D_b2
R_anb2=R_pb2-R_tb2
IBL_sb2=ifelse(R_anb2>0,R_anb2,0)
IBA_db2=ifelse(R_anb2<0,abs(R_anb2),0)
IBL_sb2b1=ifelse(IBA_db1>=IBL_sb2+IBL_sb3&IBL_sb3>0&IBL_sb2>0,IBL_sb2,ifelse(IBA_db1<IBL_sb2+IBL_sb3&IBL_sb2>0&IBL_sb3>0,IBA_db1*(IBL_sb2/(IBL_sb2+IBL_sb3)),ifelse(IBA_db1+IBA_db3>=IBL_sb2&IBL_sb2>0&IBA_db3>0,IBL_sb2*(IBA_db1/(IBA_db1+IBA_db3)),ifelse(IBA_db1+IBA_db3<IBL_sb2&IBL_sb2>0,IBA_db1,0))))
IBL_sb2b3=ifelse(IBA_db3>=IBL_sb2+IBL_sb1&IBL_sb1>0&IBL_sb2>0,IBL_sb2,ifelse(IBA_db3<IBL_sb2+IBL_sb1&IBL_sb2>0&IBL_sb1>0,IBA_db3*(IBL_sb2/(IBL_sb2+IBL_sb1)),ifelse(IBA_db3+IBA_db1>=IBL_sb2&IBL_sb2>0&IBA_db1>0,IBL_sb2*(IBA_db3/(IBA_db3+IBA_db1)),ifelse(IBA_db3+IBA_db1<IBL_sb2&IBL_sb2>0,IBA_db3,0))))
IBL_b2b1=IBL_sb2b1
IBL_b2b3=IBL_sb2b3
IBA_b2b1=IBL_b1b2
IBA_b2b3=IBL_b3b2
IBL_b2=IBL_b2b1+IBL_b2b3
IBA_b2=IBA_b2b1+IBA_b2b3
R_lb2=R_pb2+IBA_b2-IBL_b2
bb_sb2=epsiloncarbb*(bb_b2te-bb_b2(-1))
bb_b2=bb_b2(-1)+bb_sb2
r_Mcb2=ifelse(cr==1, (r_Mb2(-1)*M_b2ns(-1)+r_Mb2*M_newb2)/M_b2ns, (r_Mb2(-1)*(M_b2ns(-1)-rep_mb2-M_npb2)+r_Mb2*(1-s_b2)*M_newb2)/M_b2ns)
r_Mb2=r_cbl+epsilonm2+epsilonsfrm*(SFRt-SFRb2_e)+epsiloncarm*(CARt-CARb2_e)+epsilonr*(r_mav(-1)-r_Mb2(-1))
r_LLcb2=ifelse(cr==1, (r_LLb2(-1)*LL_b2(-1)+r_LLb2*LL_supb2)/LL_b2, (r_LLb2(-1)*(LL_b2(-1)-rep_LLb2-LL_npb2)+r_LLb2*LL_supb2)/LL_b2)
r_LLb2=r_cbl+epsilonll2+epsilonsfrll*(SFRt-SFRb2_e)+epsiloncarll*(CARt-CARb2_e)+epsilonr*(r_LLav(-1)-r_LLb2(-1))
r_SLb2=r_cbl+epsilonsl2+epsilonsfrsl*(SFRt-SFRb2_e)+epsiloncarsl*(CARt-CARb2_e)+epsilonr*(r_SLav(-1)-r_SLb2(-1))
r_db2=r_cbd+epsilond2+epsilonr*(r_dav(-1)-r_db2(-1))+epsilonsfrd*(SFRt-SFRb2_e)
D_b2=D_hb2+D_ffb2
div_b2t=max(0,V_bb2e-V_bb2te)
div_b2=max(0,div_b2(-1)+psi*(div_b2t-div_b2(-1)))
V_bb2pde=V_bb2(-1)+Pr_b2e-div_b2
bb_b2t=max(100,bb_b2(-1)+(CARt*(omega2*LL_b2+omega3*SL_b2+omega1*M_b2ns+omega0*IBL_b2)-V_bb2pde)/p_bb)
bb_b2te=bb_b2te(-1)+psi*(bb_b2t(-1)-bb_b2te(-1))
#Bank 3
iM_b3=r_Mcb3(-1)*(M_b3ns(-1)-M_npb3)
iLL_b3=r_LLcb3(-1)*(LL_b3(-1)-LL_npb3)
iSL_fb3=r_SLb3(-1)*SL_fb3(-1)
iSL_ffb3=r_SLb3(-1)*SL_ffb3(-1)
iSL_b3=iSL_fb3+iSL_ffb3
fee_b3=f*s_b3*M_newb3
iD_hb3=r_db3(-1)*D_hb3(-1)
iD_ffb3=r_db3(-1)*D_ffb3(-1)
iD_b3=iD_hb3+iD_ffb3
iIB_b3=r_IB(-1)*(IBL_b3(-1)-IBA_b3(-1))
M_b3ns=M_b3ns(-1)+(1-s_b3)*M_newb3-rep_mb3-M_npb3
M_newb3=min(xi5*M_demb3,xi6*M_demb3)
xi5=ifelse(CARb3_e/CARt<1, CARb3_e/CARt, 1)
xi6=ifelse(SFRb3_e/SFRt<1, SFRb3_e/SFRt, 1)
rep_mb3=chi_mb3*M_b3ns(-1)
M_npb3=zeta_mb3*lev_h(-1)*M_b3ns(-1)
LL_b3=LL_b3(-1)+LL_supb3-rep_LLb3-LL_npb3
LL_supb3=min(xi5*LL_db3,xi6*LL_db3)
rep_LLb3=chi_LLb3*LL_b3(-1)
LL_npb3=zeta_LLb3*lev_f(-1)*LL_b3(-1)
SL_fb3=SL_fdb3
SL_ffb3=SL_ffdb3
SL_b3=SL_fdb3+SL_ffdb3
clear_b3=(D_b3-D_b3(-1))+rep_LLb3+rep_mb3-LL_supb3-(SL_b3-SL_b3(-1))-(1-s_b3)*M_newb3+iLL_b3+iSL_b3+iM_b3-iD_b3-iBB_b3+p_bb*(bb_b3-bb_b3(-1))+fee_b3-div_b3
R_pb3=R_b3(-1)+clear_b3+IBL_b3(-1)-IBA_b3(-1)-A_b3(-1)-r_IB(-1)*IBA_b3(-1)+r_IB(-1)*IBL_b3(-1)-r_cbl(-1)*A_b3(-1)+r_cbd(-1)*R_b3(-1)
R_tb3=LCRt*omega6*D_b3
R_anb3=R_pb3-R_tb3
IBL_sb3=ifelse(R_anb3>0,R_anb3,0)
IBA_db3=ifelse(R_anb3<0,abs(R_anb3),0)
IBL_sb3b1=ifelse(IBA_db1>=IBL_sb3+IBL_sb2&IBL_sb2>0&IBL_sb3>0,IBL_sb3,ifelse(IBA_db1<IBL_sb3+IBL_sb2&IBL_sb3>0&IBL_sb2>0,IBA_db1*(IBL_sb3/(IBL_sb3+IBL_sb2)),ifelse(IBA_db1+IBA_db2>=IBL_sb3&IBL_sb3>0&IBA_db2>0,IBL_sb3*(IBA_db1/(IBA_db1+IBA_db2)),ifelse(IBA_db1+IBA_db2<IBL_sb3&IBL_sb3>0,IBA_db1,0))))
IBL_sb3b2=ifelse(IBA_db2>=IBL_sb3+IBL_sb1&IBL_sb1>0&IBL_sb3>0,IBL_sb3,ifelse(IBA_db2<IBL_sb3+IBL_sb1&IBL_sb3>0&IBL_sb1>0,IBA_db2*(IBL_sb3/(IBL_sb3+IBL_sb1)),ifelse(IBA_db2+IBA_db1>=IBL_sb3&IBL_sb3>0&IBA_db1>0,IBL_sb3*(IBA_db2/(IBA_db2+IBA_db1)),ifelse(IBA_db2+IBA_db1<IBL_sb3&IBL_sb3>0,IBA_db2,0))))
IBL_b3b1=IBL_sb3b1
IBL_b3b2=IBL_sb3b2
IBA_b3b1=IBL_b1b3
IBA_b3b2=IBL_b2b3
IBL_b3=IBL_b3b1+IBL_b3b2
IBA_b3=IBA_b3b1+IBA_b3b2
R_lb3=R_pb3+IBA_b3-IBL_b3
bb_sb3=epsiloncarbb*(bb_b3te-bb_b3(-1))
bb_b3=bb_b3(-1)+bb_sb3
r_Mcb3=ifelse(cr==1, (r_Mb3(-1)*M_b3ns(-1)+r_Mb3*M_newb3)/M_b3ns, (r_Mb3(-1)*(M_b3ns(-1)-rep_mb3-M_npb3)+r_Mb3*(1-s_b3)*M_newb3)/M_b3ns)
r_Mb3=r_cbl+epsilonm3+epsilonsfrm*(SFRt-SFRb3_e)+epsiloncarm*(CARt-CARb3_e)+epsilonr*(r_mav(-1)-r_Mb3(-1))
r_LLcb3=ifelse(cr==1, (r_LLb3(-1)*LL_b3(-1)+r_LLb3*LL_supb3)/LL_b3, (r_LLb3(-1)*(LL_b3(-1)-rep_LLb3-LL_npb3)+r_LLb3*LL_supb3)/LL_b3)
r_LLb3=r_cbl+epsilonll3+epsilonsfrll*(SFRt-SFRb3_e)+epsiloncarll*(CARt-CARb3_e)+epsilonr*(r_LLav(-1)-r_LLb3(-1))
r_SLb3=r_cbl+epsilonsl3+epsilonsfrsl*(SFRt-SFRb3_e)+epsiloncarsl*(CARt-CARb3_e)+epsilonr*(r_SLav(-1)-r_SLb3(-1))
r_db3=r_cbd+epsilond3+epsilonr*(r_dav(-1)-r_db3(-1))+epsilonsfrd*(SFRt-SFRb3_e)
D_b3=D_hb3+D_ffb3
div_b3t=max(0,V_bb3e-V_bb3te)
div_b3=max(0,div_b3(-1)+psi*(div_b3t-div_b3(-1)))
V_bb3pde=V_bb3(-1)+Pr_b3e-div_b3
bb_b3t=max(100,bb_b3(-1)+(CARt*(omega2*LL_b3+omega3*SL_b3+omega1*M_b3ns+omega0*IBL_b3)-V_bb3pde)/p_bb)
bb_b3te=bb_b3te(-1)+psi*(bb_b3t(-1)-bb_b3te(-1))
#all banks
CAR=V_bb1/(V_bb1+V_bb2+V_bb3)*CARb1+V_bb2/(V_bb1+V_bb2+V_bb3)*CARb2+V_bb3/(V_bb1+V_bb2+V_bb3)*CARb3
CAR_e=CAR_e(-1)+psi*(CAR(-1)-CAR_e(-1))
LL_sup=LL_supb1+LL_supb2+LL_supb3
r_bb=r_gb+omega12-omega13*(CAR_e-CARt)
deltabbd=bb_d-bb_d(-1)
deltabbd_e=deltabbd_e(-1)+psi*(deltabbd(-1)-deltabbd_e(-1))
p_bb=((lambdaff20-lambdaff21*ror_gbe+lambdaff22*ror_bbe-lambdaff23*ror_efe-lambdaff24*r_dav)*(TAA_ffe))/bb
r_dav=r_db1*((D_hb1(-1)+D_ffb1(-1))/(D_h(-1)+D_ff(-1)))+r_db2*((D_hb2(-1)+D_ffb2(-1))/(D_h(-1)+D_ff(-1)))+r_db3*((D_hb3(-1)+D_ffb3(-1))/(D_h(-1)+D_ff(-1)))
r_SLav=r_SLb1*((SL_fb1(-1)+SL_ffb1(-1))/(SL_f(-1)+SL_ff(-1)))+r_SLb2*((SL_fb2(-1)+SL_ffb2(-1))/(SL_f(-1)+SL_ff(-1)))+r_SLb3*((SL_fb3(-1)+SL_ffb3(-1))/(SL_f(-1)+SL_ff(-1)))
r_IB=r_cbd+((r_cbl-r_cbd)/(1+exp(-sigmaIB*(IBD-IBS))))
IBS=IBL_sb1+IBL_sb2+IBL_sb3
IBD=IBA_db1+IBA_db2+IBA_db3
div_b=div_b1+div_b2+div_b3
#Financial Firms
Pr_ff=div_f+iM_s+r_bb(-1)*bb(-1)+r_gb(-1)*gb_ff(-1)+iD_ff+div_b-fee-iSL_ff
div_ff=max(div_ff(-1)+psi_ff*(f_ff*Pr_ff-div_ff(-1)),0)
iD_ff=iD_ffb1+iD_ffb2+iD_ffb3
iM_s=r_Mcs(-1)*(M_s(-1)-M_nps)
r_Mcs=ifelse(cr==1, (r_Ms(-1)*M_s(-1)+r_Ms*(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3))/M_s, (r_Ms(-1)*(M_s(-1)-rep_ms-M_nps)+r_Ms*(s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3))/M_s)
r_Ms=(r_Mb1*M_b1ns(-1)/(M(-1)-M_s(-1))+r_Mb2*M_b2ns(-1)/(M(-1)-M_s(-1))+r_Mb3*M_b3ns(-1)/(M(-1)-M_s(-1)))
fee=fee_b1+fee_b2+fee_b3
iSL_ff=iSL_ffb1+iSL_ffb2+iSL_ffb3
rep_ms=chi_ms*M_s(-1)
M_nps=zeta_ms*lev_h(-1)*M_s(-1)
SL_ffdb1=(lambdaslff11+lambdaslff2*(r_SLb2-r_SLb1)+lambdaslff2*(r_SLb3-r_SLb1))*SL_ff
SL_ffdb2=(lambdaslff12+lambdaslff2*(r_SLb1-r_SLb2)+lambdaslff2*(r_SLb3-r_SLb2))*SL_ff
SL_ffdb3=(lambdaslff13+lambdaslff2*(r_SLb1-r_SLb3)+lambdaslff2*(r_SLb2-r_SLb3))*SL_ff
D_ffb1=(lambdadff11+lambdadff2*(r_db1-r_db2)+lambdadff2*(r_db1-r_db3))*D_ff
D_ffb2=(lambdadff12+lambdadff2*(r_db2-r_db1)+lambdadff2*(r_db2-r_db3))*D_ff
D_ffb3=(lambdadff13+lambdadff2*(r_db3-r_db1)+lambdadff2*(r_db3-r_db2))*D_ff
TAA_ff=D_ff+GB_ff+p_ef*e_f+BB
TAA_ffe=TAA_ffe(-1)+psi*(TAA_fft(-1)-TAA_ffe(-1))
TAA_fft=AE_fft*e_ff
roa_ff=Pr_ff/(D_ff+GB_ff+E_f+BB)
gb_d=((lambdaff10+lambdaff11*ror_gbe-lambdaff12*ror_bbe-lambdaff13*ror_efe-lambdaff14*r_dav)*TAA_ffe)/p_gb
GB_d=gb_d*p_gb
gb_ff=gb_ff(-1)+(gb_s-gb_rcb)-rep_gbff-gb_dcb+gb_scb
GB_ff=gb_ff*p_gb
bb_d=bb
ror_bb=iBB/BB(-1)+(p_bb-p_bb(-1))/p_bb(-1)
ror_bbe=ror_bbe(-1)+psi*(ror_bb(-1)-ror_bbe(-1))
ror_gb=iGB_ff/GB_ff(-1)+(p_gb-p_gb(-1))/p_gb(-1)
ror_gbe=ror_gbe(-1)+psi*(ror_gb(-1)-ror_gbe(-1))
ror_ef=div_f/E_f(-1)+(p_ef-p_ef(-1))/p_ef(-1)
ror_efe=ror_efe(-1)+psi*(ror_ef(-1)-ror_efe(-1))
bb=bb(-1)+bb_sb1+bb_sb2+bb_sb3
e_fd=((lambdaff30-lambdaff31*ror_gbe-lambdaff32*ror_bbe+lambdaff33*ror_efe-lambdaff34*r_dav)*(TAA_ffe))/p_ef
p_ef=((lambdaff30-lambdaff31*ror_gbe-lambdaff32*ror_bbe+lambdaff33*ror_efe-lambdaff34*r_dav)*(TAA_ffe))/e_f
e_ff=e_ffd
CARb1=(V_bb1)/(omega0*IBL_b1+omega1*M_b1ns+omega2*LL_b1+omega3*SL_b1)
V_bb1t=CARt*(omega0*IBL_b1+omega1*M_b1ns+omega2*LL_b1+omega3*SL_b1)
V_bb1te=V_bb1te(-1)+psi*(V_bb1t(-1)-V_bb1te(-1))
CARb1_e=CARb1_e(-1)+psi*(CARb1(-1)-CARb1_e(-1))
CARb2=(V_bb2)/(omega0*IBL_b2+omega1*M_b2ns+omega2*LL_b2+omega3*SL_b2)
V_bb2t=CARt*(omega0*IBL_b2+omega1*M_b2ns+omega2*LL_b2+omega3*SL_b2)
V_bb2te=V_bb2te(-1)+psi*(V_bb2t(-1)-V_bb2te(-1))
CARb2_e=CARb2_e(-1)+psi*(CARb2(-1)-CARb2_e(-1))
CARb3=(V_bb3)/(omega0*IBL_b3+omega1*M_b3ns+omega2*LL_b3+omega3*SL_b3)
V_bb3t=CARt*(omega0*IBL_b3+omega1*M_b3ns+omega2*LL_b3+omega3*SL_b3)
V_bb3te=V_bb3te(-1)+psi*(V_bb3t(-1)-V_bb3te(-1))
CARb3_e=CARb3_e(-1)+psi*(CARb3(-1)-CARb3_e(-1))
SFRb1=(omega10*D_hb1+omega11*D_ffb1+V_bb1)/(omega7*M_b1ns+omega8*LL_b1+omega9*SL_b1)
SFRb1_e=SFRb1_e(-1)+psi*(SFRb1(-1)-SFRb1_e(-1))
SFRb2=(omega10*D_hb2+omega11*D_ffb2+V_bb2)/(omega7*M_b2ns+omega8*LL_b2+omega9*SL_b2)
SFRb2_e=SFRb2_e(-1)+psi*(SFRb2(-1)-SFRb2_e(-1))
SFRb3=(omega10*D_hb3+omega11*D_ffb3+V_bb3)/(omega7*M_b3ns+omega8*LL_b3+omega9*SL_b3)
SFRb3_e=SFRb3_e(-1)+psi*(SFRb3(-1)-SFRb3_e(-1))
LCRb1=(R_b1)/(omega4*(D_b1))
LCRb2=(R_b2)/(omega5*(D_b2))
LCRb3=(R_b3)/(omega6*(D_b3))
#Government
Tax=tau*(W+div_ff+iD_h)
g=ifelse(u_e>u_n,g0+mu11*(u_n-u_e),g0+mu12*(u_n-u_e))
G=g*p
gb_s=max(0,PSBR/p_gb)
gb=gb(-1)+gb_s-rep_gbcb-rep_gbff
rep_gb=ifelse(PSBR<0, abs(PSBR)/p_gb, 0)
rep_gbcb=rep_gb*(gb_cb(-1)*p_gb(-1))/GB(-1)
rep_gbff=rep_gb*GB_ff(-1)/GB(-1)
GB=gb*p_gb
r_gb=max(r_cbl,r_cbl+mu2*gapy_e)
gap=min(PSBR/p_gb,PSBR/p_gb-(gb_d-gb_ff(-1)))
#gap=PSBR/p_gb-(gb_d-gb_ff(-1))
gapy=gap/Y
gapy_e=gapy_e(-1)+psi*(gapy(-1)-gapy_e(-1))
ror_gbt=roa_ff(-1)
p_gb=ror_gbt*p_gb(-1)-r_gb(-1)+p_gb(-1)
#Central Bank
pi=(p-p(-1))/p(-1)
r_cbd=r0+phi/2*(u(-1)-u_n)+phi/2*(pi(-1)-pit)
r_cbl=r_cbd+r1
R=R_lb1+R_lb2+R_lb3+A
gb_rcb=max(0,min(PSBR/p_gb, PSBR/p_gb-(gb_d-gb(-1))))
gb_cb=gb_cb(-1)+gb_rcb+gb_dcb-gb_scb-rep_gbcb
R_t=R_tb1+R_tb2+R_tb3
R_te=R_te(-1)+psi_cb*(R_t(-1)-R_te(-1))
R_p=R_pb1+R_pb2+R_pb3
R_pd=R_p+gb_scb*p_gb-gb_dcb*p_gb
R_pe=R_pe(-1)+psi_cb*(R_p(-1)-R_pe(-1))
R_pde=R_pde(-1)+psi_cb*(R_pd(-1)-R_pde(-1))
gb_dcb=max(0.94*(R_te-R_pde)/p_gb,0)
gb_scb=max(0,0.94*(R_pde-R_te)/p_gb)
CARt=ifelse(cyc==0,CARt0,ifelse(cyc==1, CARt0+2.1*(gDebtY(-1)+gDebtY(-2)+gDebtY(-3))/3, CARt0+1.6*(gDebtY(-1)+gDebtY(-2))/2))
SFRt=ifelse(cyc2==0,SFRt0,SFRt0+0.008*((DebtY(-1)+DebtY(-2))/2)**1.6)
DebtY=((M_b1ns+M_b2ns+M_b3ns+SL_f+LL)/Y)
gDebtY=(DebtY-DebtY(-1))/DebtY(-1)
gDebt=((M_b1ns+M_b2ns+M_b3ns+SL_f+LL)-(M_b1ns(-1)+M_b2ns(-1)+M_b3ns(-1)+SL_f(-1)+LL(-1)))/(M_b1ns(-1)+M_b2ns(-1)+M_b3ns(-1)+SL_f(-1)+LL(-1))
INV=UC*Inv
INVacc=UC*(Inv-(Inv(-1)))
dep=delta_k*k(-1)
iBB=r_bb(-1)*bb(-1)
iBB_b1=r_bb(-1)*bb_b1(-1)
iBB_b2=r_bb(-1)*bb_b2(-1)
iBB_b3=r_bb(-1)*bb_b3(-1)
iGB=r_gb(-1)*gb(-1)
iGB_cb=r_gb(-1)*gb_cb(-1)
iGB_ff=r_gb(-1)*gb_ff(-1)
iIBA_b1=r_IB(-1)*IBA_b1(-1)
iIBA_b2=r_IB(-1)*IBA_b2(-1)
iIBA_b3=r_IB(-1)*IBA_b3(-1)
iIBL_b1=r_IB(-1)*IBL_b1(-1)
iIBL_b2=r_IB(-1)*IBL_b2(-1)
iIBL_b3=r_IB(-1)*IBL_b3(-1)
iIB_netb1=iIBL_b1-iIBA_b1
iIB_netb2=iIBL_b2-iIBA_b2
iIB_netb3=iIBL_b3-iIBA_b3
iCBA=r_cbl(-1)*A(-1)
iCBD=r_cbd(-1)*R(-1)
iCBA_b1=r_cbl(-1)*A_b1(-1)
iCBA_b2=r_cbl(-1)*A_b2(-1)
iCBA_b3=r_cbl(-1)*A_b3(-1)
iCBD_b1=r_cbd(-1)*R_b1(-1)
iCBD_b2=r_cbd(-1)*R_b2(-1)
iCBD_b3=r_cbd(-1)*R_b3(-1)
deltadep_h=D_h-D_h(-1)
deltadep_ff=D_ff-D_ff(-1)
deltadep_b1=D_b1-D_b1(-1)
deltadep_b2=D_b2-D_b2(-1)
deltadep_b3=D_b3-D_b3(-1)
deltaGB=p_gb*(gb-gb(-1))
deltaGB_ff=p_gb*(gb_ff-gb_ff(-1))
deltaGB_cb=p_gb*(gb_cb-gb_cb(-1))
deltaCBA=A-A(-1)
deltaCBA_b1=A_b1-A_b1(-1)
deltaCBA_b2=A_b2-A_b2(-1)
deltaCBA_b3=A_b3-A_b3(-1)
deltaR=R-R(-1)
deltaR_b1=R_b1-R_b1(-1)
deltaR_b2=R_b2-R_b2(-1)
deltaR_b3=R_b3-R_b3(-1)
deltaIBL_b1=IBL_b1-IBL_b1(-1)
deltaIBL_b2=IBL_b2-IBL_b2(-1)
deltaIBL_b3=IBL_b3-IBL_b3(-1)
deltaIBA_b1=IBA_b1-IBA_b1(-1)
deltaIBA_b2=IBA_b2-IBA_b2(-1)
deltaIBA_b3=IBA_b3-IBA_b3(-1)
deltaM=M_new-rep_m
deltaM_b1=(1-s_b1)*M_newb1-rep_mb1
deltaM_b2=(1-s_b2)*M_newb2-rep_mb2
deltaM_b3=(1-s_b3)*M_newb3-rep_mb3
deltaM_s=s_b1*M_newb1+s_b2*M_newb2+s_b3*M_newb3-rep_ms
deltaLL=LL_sup-rep_LL
deltaLL_b1=LL_supb1-rep_LLb1
deltaLL_b2=LL_supb2-rep_LLb2
deltaLL_b3=LL_supb3-rep_LLb3
deltaSL_f=SL_f-SL_f(-1)
deltaSL_ff=SL_ff-SL_ff(-1)
deltaSL_b1=SL_b1-SL_b1(-1)
deltaSL_b2=SL_b2-SL_b2(-1)
deltaSL_b3=SL_b3-SL_b3(-1)
deltae_ff=e_ff-e_ff(-1)
BB=p_bb*bb
BB_b1=p_bb*bb_b1
BB_b2=p_bb*bb_b2
BB_b3=p_bb*bb_b3
deltaBB=p_bb*(bb-bb(-1))
deltaBB_b1=p_bb*(bb_b1-bb_b1(-1))
deltaBB_b2=p_bb*(bb_b2-bb_b2(-1))
deltaBB_b3=p_bb*(bb_b3-bb_b3(-1))
V_hlag=V_h(-1)
V_flag=V_f(-1)
V_b1lag=V_b1(-1)
V_b2lag=V_b2(-1)
V_b3lag=V_b3(-1)
V_fflag=V_ff(-1)
V_glag=V_g(-1)
V_cblag=V_cb(-1)
CG_h=(p_h-p_h(-1))*h+M_np
CG_f=(UC-UC(-1))*Inv(-1)+(p-p(-1))*(k(-1)-delta_k*k(-1))-(p_ef-p_ef(-1))*e_f-delta_k*k(-1)*p(-1)+LL_np
CG_b1=-(p_bb-p_bb(-1))*bb_b1(-1)-LL_npb1-M_npb1
CG_b2=-(p_bb-p_bb(-1))*bb_b2(-1)-LL_npb2-M_npb2
CG_b3=-(p_bb-p_bb(-1))*bb_b3(-1)-LL_npb3-M_npb3
CG_ff=(p_gb-p_gb(-1))*gb_ff(-1)+(p_ef-p_ef(-1))*e_f+(p_bb-p_bb(-1))*bb(-1)-M_nps
CG_g=-(p_gb-p_gb(-1))*gb(-1)
CG_cb=(p_gb-p_gb(-1))*gb_cb(-1)
GB_cb=p_gb*gb_cb
E_f=p_ef*e_f
H=p_h*h
dTAA_ffe=TAA_ffe-TAA_ffe(-1)
dror=ror_gbe-ror_gbe(-1)
dpgb=p_gb-p_gb(-1)
drgb=r_gb-r_gb(-1)
yieldBB=iBB/BB(-1)
CGBB=(p_bb-p_bb(-1))/p_bb(-1)
yieldEF=div_f/E_f(-1)
yieldEFalt=div_f/e_f
CGEF=(p_ef-p_ef(-1))/p_ef(-1)
yieldGB=iGB_ff/GB_ff(-1)
CGGB=(p_gb-p_gb(-1))/p_gb(-1)
yde=YD_e/p_e
vhe=V_h(-1)/p_e
rwb=W/p
rdiv=div_ff/p
#2. Parameters
sav_h = 7963.48175888136 
V_h = 2211235.20937807 
D_h = 631658.400490524 
YD = 361262.451079441 
M = 254680.597674263 
sav_f = 3146.98391869907 
V_f = -4854711.51113178 
SL_f = 411668.194798403 
K = 526523.444729056 
k = 16204.2913835064 
LL = 601721.767021202 
sav_b1 = 8270.71657577855 
Pr_b1 = 22562.2974982109 
Pr_b1e = 22843.1238353933 
V_b1 = -116051.475036202 
V_bb1 = 133530.261113074 
V_bb1e = 150376.527981587 
A_b1 = 11755.5076594218 
R_b1 = 18402.6733834192 
sav_b2 = 8270.71657577855 
Pr_b2 = 22562.2974982109 
Pr_b2e = 22843.1238353933 
V_b2 = -116051.475036202 
V_bb2 = 133530.261113074 
V_bb2e = 150376.527981587 
A_b2 = 11755.5076594218 
R_b2 = 18402.6733834192 
sav_b3 = 8270.71657577855 
Pr_b3 = 22562.2974982109 
Pr_b3e = 22843.1238353933 
V_b3 = -116051.475036202 
V_bb3 = 133530.261113074 
V_bb3e = 150376.527981587 
A_b3 = 11755.5076594218 
R_b3 = 18402.6733834192 
sav_ff = 9686.20966201377 
V_ff = 64467620.6976597 
SL_ff = 0 
D_ff = 204826.75330126 
M_s = 50936.1195348534 
sav_g = -14920.2595168649 
PSBR = 14920.2595168649 
V_g = -61796094.8096643 
PCB = 1950.76571944622 
sav_cb = 0 
V_cb = 1883363.7073288 
A = 35266.5229782655 
YD_e = 347427.84101664 
p_e = 30.4926491528792 
V_he = 2241982.76769443 
CG_he = 26054.1907180263 
c_d = 10873.1330041891 
rr_d = 0.00079127045037386 
alpha1 = 0.741110521562726 
alpha2 = 0.0336665782344089 
rr_de = -0.00594918023484511 
C = 353298.96932056 
M_dem = 29233.7180769118 
H_dn = 64963.817948693 
r_mav = 0.0909847745746425 
M_demb1 = 9744.57269230395 
M_demb2 = 9744.57269230395 
M_demb3 = 9744.57269230395 
H_def = 63340.3054532267 
H_s = 63340.3054532267 
p_h = 86.8366144941227 
lev_h = 0.103280329744388 
iM = 23835.6325841728 
iD_h = 18084.9736119951 
M_new = 27610.2055814456 
rep_m = 25287.977138397 
M_np = 521.40215275136 
TAA_h = 1515811.22525394 
TAA_he = 1495481.42399895 
e_ffd = 884152.824763412 
ror_eff = 0.138580867013653 
ror_effe = 0.13669761479788 
D_hb1 = 210552.800163508 
D_hb2 = 210552.800163508 
D_hb3 = 210552.800163508 
N_s = 502.672564657611 
w = 19.6399724647035 
u_nw = 0.88903787337002 
u_e = 0.835211239425259 
p = 32.4928398451894 
UC = 22.2630182555227 
UC_e = 21.1203458993731 
W = 320784.759728997 
y = 14408.8620890126 
c = 10873.1330041891 
N_d = 502.672564657611 
Y = 468184.848209707 
I = 30976.641632258 
i_d = 1056.8356141782 
lev_f = 1.14282046325751 
r_LLav = 0.0996334758223853 
i = 953.337466957177 
LL_d = 60554.8125551556 
LL_db1 = 20184.9375183852 
LL_db2 = 20184.9375183852 
LL_db3 = 20184.9375183852 
c_e = 11144.9218394575 
Inv_t = 3619.45542191051 
Inv = 3891.24425717886 
SL_fdb1 = 137222.731599468 
SL_fdb2 = 137222.731599468 
SL_fdb3 = 137222.731599468 
u = 0.835800716447732 
Pr_f = 60730.7736558969 
sav_ft = 3146.98391869909 
div_f = 57583.7897371978 
rep_LL = 29362.2061196701 
LL_np = 13352.0130857631 
iLL = 55691.770851198 
iSL_f = 31109.9144766286 
iM_b1 = 6388.52361574798 
iLL_b1 = 18563.923617066 
iSL_fb1 = 10369.9714922095 
iSL_ffb1 = 0 
iSL_b1 = 10369.9714922095 
iD_hb1 = 6028.32453733169 
iD_ffb1 = 1669.17703768976 
iD_b1 = 7697.50157502144 
iIB_b1 = 0 
fee_b1 = 184.068037209637 
M_b1ns = 67914.8260464713 
M_newb1 = 9203.40186048186 
xi1 = 0.944464385570289 
xi2 = 1 
rep_mb1 = 6743.4605702392 
M_npb1 = 139.040574067029 
LL_b1 = 200573.922340399 
LL_supb1 = 19063.9546110763 
rep_LLb1 = 9787.40203989002 
LL_npb1 = 4450.6710285877 
SL_fb1 = 137222.731599468 
SL_ffb1 = 0 
SL_b1 = 137222.731599468 
clear_b1 = 13183.3556198041 
R_pb1 = 6647.16572399742 
R_tb1 = 18402.6733834192 
R_anb1 = -11755.5076594218 
IBL_sb1 = 0 
IBA_db1 = 11755.5076594218 
IBL_sb1b2 = 0 
IBL_sb1b3 = 0 
IBL_b1b2 = 0 
IBL_b1b3 = 0 
IBA_b1b2 = 0 
IBA_b1b3 = 0 
IBL_b1 = 0 
IBA_b1 = 0 
R_lb1 = 6647.16572399742 
div_b1t = 16482.8204930041 
div_b1 = 18881.2925250871 
V_bb1pde = 131495.2354565 
bb_b1t = 1119.64507156067 
bb_b1te = 1106.35067506051 
bb_sb1 = 10.1713733566121 
bb_b1 = 1096.1793017039 
r_SLb1 = 0.0796334758223864 
r_LLcb1 = 0.102689195753703 
r_LLb1 = 0.0996334758223861 
r_Mcb1 = 0.0993935930448339 
r_Mb1 = 0.0909847745746407 
r_db1 = 0.0310058405398228 
D_b1 = 278828.384597261 
iM_b2 = 6388.52361574798 
iLL_b2 = 18563.923617066 
iSL_fb2 = 10369.9714922095 
iSL_ffb2 = 0 
iSL_b2 = 10369.9714922095 
fee_b2 = 184.068037209637 
iD_hb2 = 6028.32453733169 
iD_ffb2 = 1669.17703768976 
iD_b2 = 7697.50157502144 
iIB_b2 = 0 
M_b2ns = 67914.8260464713 
M_newb2 = 9203.40186048186 
xi3 = 0.944464385570289 
xi4 = 1 
rep_mb2 = 6743.4605702392 
M_npb2 = 139.040574067029 
LL_b2 = 200573.922340399 
LL_supb2 = 19063.9546110763 
rep_LLb2 = 9787.40203989002 
LL_npb2 = 4450.6710285877 
SL_fb2 = 137222.731599468 
SL_ffb2 = 0 
SL_b2 = 137222.731599468 
clear_b2 = 13183.3556198041 
R_pb2 = 6647.16572399742 
R_tb2 = 18402.6733834192 
R_anb2 = -11755.5076594218 
IBL_sb2 = 0 
IBA_db2 = 11755.5076594218 
IBL_sb2b1 = 0 
IBL_sb2b3 = 0 
IBL_b2b1 = 0 
IBL_b2b3 = 0 
IBA_b2b1 = 0 
IBA_b2b3 = 0 
IBL_b2 = 0 
IBA_b2 = 0 
R_lb2 = 6647.16572399742 
bb_sb2 = 10.1713733566121 
bb_b2 = 1096.1793017039 
r_Mcb2 = 0.0993935930448339 
r_Mb2 = 0.0909847745746407 
r_LLcb2 = 0.102689195753703 
r_LLb2 = 0.0996334758223861 
r_SLb2 = 0.0796334758223864 
r_db2 = 0.0310058405398228 
D_b2 = 278828.384597261 
div_b2t = 16482.8204930041 
div_b2 = 18881.2925250871 
V_bb2pde = 131495.2354565 
bb_b2t = 1119.64507156067 
bb_b2te = 1106.35067506051 
iM_b3 = 6388.52361574798 
iLL_b3 = 18563.923617066 
iSL_fb3 = 10369.9714922095 
iSL_ffb3 = 0 
iSL_b3 = 10369.9714922095 
fee_b3 = 184.068037209637 
iD_hb3 = 6028.32453733169 
iD_ffb3 = 1669.17703768976 
iD_b3 = 7697.50157502144 
iIB_b3 = 0 
M_b3ns = 67914.8260464713 
M_newb3 = 9203.40186048186 
xi5 = 0.944464385570289 
xi6 = 1 
rep_mb3 = 6743.4605702392 
M_npb3 = 139.040574067029 
LL_b3 = 200573.922340399 
LL_supb3 = 19063.9546110763 
rep_LLb3 = 9787.40203989002 
LL_npb3 = 4450.6710285877 
SL_fb3 = 137222.731599468 
SL_ffb3 = 0 
SL_b3 = 137222.731599468 
clear_b3 = 13183.3556198041 
R_pb3 = 6647.16572399742 
R_tb3 = 18402.6733834192 
R_anb3 = -11755.5076594218 
IBL_sb3 = 0 
IBA_db3 = 11755.5076594218 
IBL_sb3b1 = 0 
IBL_sb3b2 = 0 
IBL_b3b1 = 0 
IBL_b3b2 = 0 
IBA_b3b1 = 0 
IBA_b3b2 = 0 
IBL_b3 = 0 
IBA_b3 = 0 
R_lb3 = 6647.16572399742 
bb_sb3 = 10.1713733566121 
bb_b3 = 1096.1793017039 
r_Mcb3 = 0.0993935930448339 
r_Mb3 = 0.0909847745746407 
r_LLcb3 = 0.102689195753703 
r_LLb3 = 0.0996334758223861 
r_SLb3 = 0.0796334758223864 
r_db3 = 0.0310058405398228 
D_b3 = 278828.384597261 
div_b3t = 16482.8204930041 
div_b3 = 18881.2925250871 
V_bb3pde = 131495.2354565 
bb_b3t = 1119.64507156067 
bb_b3te = 1106.35067506051 
CAR = 0.455803941143612 
CAR_e = 0.448620583145887 
LL_sup = 57191.863833229 
r_bb = 0.0816897502974783 
deltabbd = 30.5141200698363 
deltabbd_e = 19.8778780633757 
p_bb = 227.683313999202 
r_dav = 0.0310058405398228 
r_SLav = 0.0796334758223864 
r_IB = 0.0563899695836555 
IBS = 0 
IBD = 35266.5229782655 
div_b = 56643.8775752612 
Pr_ff = 131390.201388908 
div_ff = 121703.991726894 
iD_ff = 5007.53111306927 
iM_s = 4670.06173692883 
r_Mcs = 0.0969276530068748 
r_Ms = 0.0909847745746425 
fee = 552.204111628912 
iSL_ff = 0 
rep_ms = 5057.5954276794 
M_nps = 104.280430550272 
SL_ffdb1 = 0 
SL_ffdb2 = 0 
SL_ffdb3 = 0 
D_ffb1 = 68275.5844337535 
D_ffb2 = 68275.5844337535 
D_ffb3 = 68275.5844337535 
TAA_ff = 65300837.4028882 
TAA_ffe = 8752692.54393734 
TAA_fft = 8841528.24763412 
roa_ff = 0.00201207529052447 
gb_d = 3039.75264501571 
GB_d = 1320587.5102486 
gb_ff = 137862.32582602 
GB_ff = 59892789.6051636 
bb_d = 3288.53790511171 
ror_bb = -0.00560044725602055 
ror_bbe = -0.0054952757046798 
ror_gb = 0.00217912454459949 
ror_gbe = 0.00221119538321335 
ror_ef = 0.0167635755930471 
ror_efe = 0.0125549560987449 
bb = 3288.53790511171 
e_fd = 17198.43 
p_ef = 259.00479497114 
e_ff = 884152.824763412 
CARb1 = 0.455803941143612 
V_bb1t = 139153.851696789 
V_bb1te = 133893.707488583 
CARb1_e = 0.448620583145887 
CARb2 = 0.455803941143612 
V_bb2t = 139153.851696789 
V_bb2te = 133893.707488583 
CARb2_e = 0.448620583145887 
CARb3 = 0.455803941143612 
V_bb3t = 139153.851696789 
V_bb3te = 133893.707488583 
CARb3_e = 0.448620583145887 
SFRb1 = 1.07007529422156 
SFRb1_e = 1.07142270859591 
SFRb2 = 1.07007529422156 
SFRb2_e = 1.07142270859591 
SFRb3 = 1.07007529422156 
SFRb3_e = 1.07142270859591 
LCRb1 = 0.6 
LCRb2 = 0.6 
LCRb3 = 0.6 
Tax = 75475.6414042719 
g = 2595.33128664286 
G = 84329.6838420956 
gb_s = 34.3437280594702 
gb = 142243.388788341 
rep_gb = 0 
rep_gbcb = 0 
rep_gbff = 0 
GB = 61796094.8096643 
r_gb = 0.0564138669266557 
gap = 34.3437280594702 
gapy = 7.33550609140755e-05 
gapy_e = 7.4330771384862e-05 
ror_gbt = 0.0021791245445995 
p_gb = 434.439135175677 
pi = 0.0301906810956214 
r_cbd = 0.0431481113994135 
r_cbl = 0.0563899695836555 
R = 55208.0201502578 
gb_rcb = 34.3437280594702 
gb_cb = 4381.0629623207 
R_t = 55208.0201502577 
R_te = 53123.1805498363 
R_p = 19941.4971719923 
R_pd = -2979.6148158961 
R_pe = -9809.68418198145 
R_pde = 28739.0188605933 
gb_dcb = 52.7602375845343 
gb_scb = 0 
DebtY = 2.59968780410819 
gDebtY = -0.0119721733830893 
gDebt = 0.0130088845655248 
INV = 86630.841934271 
INVacc = -288.076082193069 
dep = 1126.65705600367 
iBB = 262.232904379184 
iBB_b1 = 87.4109681263946 
iBB_b2 = 87.4109681263946 
iBB_b3 = 87.4109681263946 
iGB = 8016.98279848744 
iGB_cb = 242.0703647871 
iGB_ff = 7774.91243370035 
iIBA_b1 = 0 
iIBA_b2 = 0 
iIBA_b3 = 0 
iIBL_b1 = 0 
iIBL_b2 = 0 
iIBL_b3 = 0 
iIB_netb1 = 0 
iIB_netb2 = 0 
iIB_netb3 = 0 
iCBA = 3987.63186106313 
iCBD = 2278.936506404 
iCBA_b1 = 1329.21062035438 
iCBA_b2 = 1329.21062035438 
iCBA_b3 = 1329.21062035438 
iCBD_b1 = 759.645502134668 
iCBD_b2 = 759.645502134668 
iCBD_b3 = 759.645502134668 
deltadep_h = 4349.29690679885 
deltadep_ff = 31131.7332751536 
deltadep_b1 = 11827.0100606508 
deltadep_b2 = 11827.0100606508 
deltadep_b3 = 11827.0100606508 
deltaGB = 14920.2595168632 
deltaGB_ff = -22921.1119878869 
deltaGB_cb = 37841.3715047532 
deltaCBA = -35499.6235127444 
deltaCBA_b1 = -11833.2078375815 
deltaCBA_b2 = -11833.2078375815 
deltaCBA_b3 = -11833.2078375815 
deltaR = 2341.74799200887 
deltaR_b1 = 780.582664002955 
deltaR_b2 = 780.582664002955 
deltaR_b3 = 780.582664002955 
deltaIBL_b1 = 0 
deltaIBL_b2 = 0 
deltaIBL_b3 = 0 
deltaIBA_b1 = 0 
deltaIBA_b2 = 0 
deltaIBA_b3 = 0 
deltaM = 2322.22844304858 
deltaM_b1 = 619.260918146289 
deltaM_b2 = 619.260918146289 
deltaM_b3 = 619.260918146289 
deltaM_s = 464.445688609717 
deltaLL = 27829.657713559 
deltaLL_b1 = 9276.55257118632 
deltaLL_b2 = 9276.55257118632 
deltaLL_b3 = 9276.55257118632 
deltaSL_f = -288.07608219306 
deltaSL_ff = 0 
deltaSL_b1 = -96.0253607310297 
deltaSL_b2 = -96.0253607310297 
deltaSL_b3 = -96.0253607310297 
deltae_ff = 5936.41329513106 
BB = 748745.208447828 
BB_b1 = 249581.736149276 
BB_b2 = 249581.736149276 
BB_b3 = 249581.736149276 
deltaBB = 6947.55598126989 
deltaBB_b1 = 2315.85199375663 
deltaBB_b2 = 2315.85199375663 
deltaBB_b3 = 2315.85199375663 
V_hlag = 2200051.36584909 
V_flag = -4835434.816668 
V_b1lag = -121212.981993151 
V_b2lag = -121212.981993151 
V_b3lag = -121212.981993151 
V_fflag = 64323150.9809095 
V_glag = -61654837.9622491 
V_cblag = 1879549.01236348 
CG_h = 3220.36177009792 
CG_f = -22423.6783824874 
CG_b1 = -3109.20961882922 
CG_b2 = -3109.20961882922 
CG_b3 = -3109.20961882922 
CG_ff = 134783.507088151 
CG_g = -126336.587898354 
CG_cb = 3814.69496532812 
GB_cb = 1903305.2045008 
E_f = 4454475.83597551 
H = 950104.5817984 
dTAA_ffe = 29471.5707454737 
dror = 7.70346606599106e-05 
dpgb = 0.888386444369985 
drgb = 3.92334067617281e-05 
yieldBB = 0.000351405982145317 
CGBB = -0.00595185323816587 
yieldEF = 0.0129761361343143 
yieldEFalt = 3.34820037277808 
CGEF = 0.00378743945873273 
yieldGB = 0.000130030068417278 
CGGB = 0.00204909447618221 
alpha1L = 0.65 
alpha1U = 0.75 
alpha2L = 0.02 
alpha2U = 0.035 
sigmampc1 = 55 
sigmampc2 = 2 
rho0 = 15151.74 
rho1 = 0.04452939 
rho2 = 100823.8 
rho3 = 53046.65 
lambdam11 = 0.333333333333333 
lambdam12 = 0.333333333333333 
lambdam13 = 0.333333333333333 
lambdam2 = 353936.6667 
eta = 0.0666666666666667 
lambdaeff10 = 0.5912795 
lambdaeff11 = 0.05
lambdaeff12 = 0.05 
lambdaeff13 = 0.05 
lambdadh11 = 0.333333333333333 
lambdadh12 = 0.333333333333333 
lambdadh13 = 0.333333333333333 
lambdadff11 = 0.333333333333333 
lambdadff12 = 0.333333333333333 
lambdadff13 = 0.333333333333333 
lambdadh2 = 4374075 
lambdadff2 = 3583533.03055556 
beta1 = 0.11 
theta = 0.538461538461538 
kappa = 0.95 
alpha = 28.6645086724138 
#gamma0 = 1505
gamma0 = 1500
gammau = 2100 
gammal = 3500 
lambdall11 = 0.333333333333333 
lambdall12 = 0.333333333333333 
lambdall13 = 0.333333333333333 
lambdall2 = 5399434.14306699 
gamma1 = 0.25 
lambdaslf11 = 0.333333333333333 
lambdaslf12 = 0.333333333333333 
lambdaslf13 = 0.333333333333333 
lambdaslff11 = 0.333333333333333 
lambdaslff12 = 0.333333333333333 
lambdaslff13 = 0.333333333333333 
lambdaslf2 = 1423560 
lambdaslff2 = 1711406.96944444 
s_b1 = 0.2 
s_b2 = 0.2 
s_b3 = 0.2 
chi_mb1 = 0.1 
zeta_mb1 = 0.02 
chi_mb2 = 0.1 
zeta_mb2 = 0.02 
chi_mb3 = 0.1 
zeta_mb3 = 0.02 
chi_ms = 0.1 
zeta_ms = 0.02 
chi_LLb1 = 0.05 
zeta_LLb1 = 0.02 
chi_LLb2 = 0.05 
zeta_LLb2 = 0.02 
chi_LLb3 = 0.05 
zeta_LLb3 = 0.02 
epsiloncarbb = 0.5 
epsilonsl1 = 0.03 
epsilonsl2 = 0.03 
epsilonsl3 = 0.03 
epsiloncarsl = 0.15 
epsilonsfrsl = 0.15 
epsilonr = 0.3 
epsilonll1 = 0.05 
epsilonll2 = 0.05 
epsilonll3 = 0.05 
epsiloncarll = 0.15 
epsilonsfrll = 0.15 
epsilonm1 = 0.04 
epsilonm2 = 0.04 
epsilonm3 = 0.04 
epsiloncarm = 0.12 
epsilonsfrm = 0.12 
epsilond1 = -0.005 
epsilond2 = -0.005 
epsilond3 = -0.005 
epsilonsfrd = 0.1 
lambdaff10 = 0.15127968 
lambdaff11 = 0.1 
lambdaff12 = 0.04
lambdaff13 = 0.04 
lambdaff14 = 0.02 
lambdaff20 = 0.0855549 
lambdaff21 = 0.04
lambdaff22 = 0.07 
lambdaff23 = 0.04 
lambdaff24 = 0.01 
lambdaff30 = 0.5083361 
lambdaff31 = 0.04 
lambdaff32 = 0.02 
lambdaff33 = 0.07 
lambdaff34 = 0.01
omega0 = 0.2 
omega1 = 0.35 
omega2 = 1 
omega3 = 0.5 
omega4 = 0.11 
omega5 = 0.11 
omega6 = 0.11 
omega12 = 0.02 
omega13 = 0.2 
omega7 = 1 
omega8 = 1 
omega9 = 0.5 
omega10 = 0.925 
omega11 = 0.475 
mu11 = 3250 
mu12 = 6500 
mu1 = 9750 
mu2 = 0.3215 
mu3 = 2.5e-06 
phiu = 0.3 
phipi = 0.3 
phi = 0.6 
sigmaIB = 0.002 
psi = 0.5 
psi_cb = 0.75 
psi_gb = 0.4 
psi_ff = 0.3 
iota_ff = 0.1 
psiu = 0.0475 
delta_k = 0.0687925154585626 
LTV = 0.45 
u_n = 0.865262206601083 
h = 10941.29 
e_f = 17198.43 
lev_ft = 1.2 
tau = 0.163873094135249 
pit = 0 
f = 0.1 
f_f = 0.775 
f_ff = 0.9 
CARt0 = 0.475 
cyc = 0 
cyc2 = 0
cr = 1
SFRt0 = 1 
LCRt = 0.6 
g0 = 2400
r0 = 0.042852 
r1 = 0.013241858184242 
AE_fft = 10 
delta_u = 0 
delta_ue = 0 
#4.Timeline
timeline 1 500
